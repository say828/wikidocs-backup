# 05장: 시스템의 혈관: VPC, 라우팅, 그리고 연결성

지금까지의 여정을 통해 우리는 견고한 IaC(2장)라는 대지 위에 컴퓨팅(3장)이라는 심장을 얹고, 데이터(4장)라는 혈액을 공급했다. 이제 우리의 클라우드 네이티브 애플리케이션이라는 생명체는 심장과 혈액을 갖추었지만, 아직 결정적인 것이 빠져있다. 바로 이 혈액을 몸 구석구석의 장기(마이크로서비스)로 안전하고 효율적으로 전달하고, 외부 세계와 산소(정보)를 교환하게 할 **혈관과 신경망**, 즉 **네트워크 아키텍처**다.

네트워킹은 종종 애플리케이션 개발자들에게 어렵고 멀게 느껴지는 영역이다. 하지만 클라우드 네이티브 아키텍처에서 네트워크 설계는 보안, 안정성, 성능의 가장 근간을 이루는 주춧돌이다. 아무리 뛰어난 마이크로서비스와 데이터베이스를 갖추었다 한들, 이들을 연결하는 혈관이 막히거나 잘못된 방향으로 뚫려 있다면 시스템은 제대로 기능할 수 없으며, 외부의 바이러스(공격)에 무방비로 노출될 것이다.

이 장에서는 AWS 네트워킹의 심장인 \*\*VPC(Virtual Private Cloud)\*\*를 통해, 클라우드 위에 우리만의 격리되고 안전한 데이터 센터를 설계하는 방법을 처음부터 끝까지 탐구한다. 우리는 VPC라는 땅의 경계를 정하고, 서브넷이라는 구획을 나누며, 라우팅 테이블과 보안 그룹이라는 교통 규칙을 만들어 트래픽의 흐름을 완벽하게 제어할 것이다. 그리고 인터넷 게이트웨이와 NAT 게이트웨이를 통해 외부 세계와 어떻게 소통할지, VPC 엔드포인트를 통해 어떻게 AWS 서비스와 안전하게 내부적으로 통신할지를 배운다. 이 장을 마치고 나면, 당신은 더 이상 네트워크를 두려운 미지의 영역이 아닌, 당신의 아키텍처를 더욱 견고하고 안전하게 만드는 가장 강력한 무기로 활용할 수 있게 될 것이다.

-----

## 00\. VPC: 클라우드 위의 나만의 데이터 센터 설계

AWS를 처음 시작하면 모든 것이 거대하고 열린 퍼블릭 클라우드 공간에 존재하는 것처럼 느껴진다. 하지만 우리가 프로덕션급의 안전한 시스템을 구축하기 위한 첫걸음은, 이 광활한 퍼블릭 공간 안에 논리적으로 완벽하게 격리된 **나만의 사적인 공간**을 만드는 것에서부터 시작된다. \*\*VPC(Virtual Private Cloud)\*\*는 바로 그 역할을 한다. VPC는 AWS 클라우드 안에 당신만이 제어할 수 있는 가상의 데이터 센터, 혹은 당신이 직접 경계와 내부 규칙을 정할 수 있는 디지털 사유지와 같다.

이 사유지를 만드는 첫 번째 행위는 **땅의 주소를 정하는 것**이다. VPC에서는 이것을 **CIDR(Classless Inter-Domain Routing) 블록**을 할당하는 것에 비유할 수 있다. 예를 들어 `10.0.0.0/16`이라는 CIDR 블록을 VPC에 할당하는 것은, "지금부터 10.0.0.0부터 10.0.255.255까지의 모든 IP 주소는 우리 데이터 센터에서만 사용할 고유한 주소다"라고 선언하는 것과 같다.

이 결정은 집을 짓기 전에 땅의 크기와 주소를 정하는 것만큼이나 중요하며, 한번 결정하면 변경하기가 극도로 어렵다. 만약 당신의 회사가 나중에 온프레미스 데이터 센터(예: `10.0.0.0/8` 대역 사용)와 이 VPC를 연결(VPN 또는 Direct Connect)해야 하는 상황이 온다면 어떻게 될까? 두 네트워크의 IP 주소 대역이 겹치면서 끔찍한 주소 충돌이 발생하고, 통신은 불가능해진다. 따라서 VPC의 CIDR 블록을 설계할 때는 항상 미래의 연결 가능성을 염두에 두고, 조직 내의 다른 네트워크나 향후 연결될 다른 VPC와 절대 겹치지 않는 **고유한 IP 주소 범위**를 신중하게 선택해야 한다.

VPC가 제공하는 가장 강력한 가치는 \*\*기본적인 격리(Isolation by Default)\*\*다. 당신이 VPC를 생성하는 순간, 그 안은 외부 인터넷은 물론, 같은 AWS 계정 내의 다른 VPC로부터도 완벽하게 차단된 하나의 섬이 된다. 이 섬 안의 리소스들끼리는 자유롭게 통신할 수 있지만, 당신이 명시적으로 문(게이트웨이)을 열고 길(라우팅)을 내주지 않는 한, 그 어떤 트래픽도 이 섬에 들어오거나 나갈 수 없다. 이는 **'실패에 안전한(Fail-safe)'** 보안 원칙의 출발점으로, 실수로 리소스를 외부에 노출할 위험을 원천적으로 차단한다.

우리는 이미 2장에서 AWS CDK의 고수준 Construct인 `ec2.Vpc`를 사용하여 이 모든 과정을 단 몇 줄의 코드로 구현했다.

```typescript
// lib/stacks/core-network-stack.ts (복습)
this.vpc = new ec2.Vpc(this, 'NextGenCommerceVPC', {
  ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'), // 👈 VPC의 CIDR 블록 선언
  maxAzs: 2,
  // ... 서브넷 설정 ...
});
```

이 코드는 단순히 VPC라는 껍데기만 만든 것이 아니다. CDK는 내부적으로 AWS의 모범 사례에 따라 퍼블릭 및 프라이빗 서브넷, 각 서브넷을 위한 라우팅 테이블, 외부 통신을 위한 인터넷 게이트웨이와 NAT 게이트웨이까지 자동으로 생성했다. 이제부터 우리는 이 마법과 같았던 추상화의 커튼을 걷고, 그 안에 숨겨진 각각의 구성 요소들이 어떤 역할을 하며 어떻게 유기적으로 동작하는지 그 원리를 파헤쳐 볼 것이다.

VPC라는 땅의 경계를 정했으니, 이제 그 안에 건물을 올리고 용도에 맞게 방을 나눌 차례다. 시스템의 혈관을 모세혈관까지 뻗어 나가게 할 서브넷, 그리고 그 혈액의 흐름을 지시할 라우팅 테이블과 보안 그룹의 세계로 들어가 보자.