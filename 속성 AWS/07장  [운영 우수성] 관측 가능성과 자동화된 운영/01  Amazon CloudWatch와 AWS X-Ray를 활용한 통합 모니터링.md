## 01. Amazon CloudWatch와 AWS X-Ray를 활용한 통합 모니터링

관측 가능성의 세 기둥—메트릭, 로그, 트레이스—의 중요성을 이해했다면, 이제 이들을 AWS 생태계에서 어떻게 실제로 구현할지 알아볼 차례다. AWS는 이 세 가지 데이터를 수집, 분석, 시각화하고 조치를 취하기 위한 통합 플랫폼으로 **Amazon CloudWatch**와 **AWS X-Ray**라는 두 가지 핵심 서비스를 제공한다. 이 둘은 별개의 서비스가 아니라, 분산 시스템의 복잡한 문제를 해결하기 위해 유기적으로 함께 작동하도록 설계된 강력한 콤비다.

---

### Amazon CloudWatch: 시스템의 중앙 관제탑 📡

**CloudWatch**는 AWS의 모든 리소스와 애플리케이션을 위한 중앙 모니터링 및 관측 가능성 서비스다. 이것은 우리 아키텍처의 모든 신호를 수집하고 분석하여 의미 있는 정보로 변환하는 중앙 관제탑과 같다. CloudWatch는 관측 가능성의 두 기둥인 **메트릭**과 **로그**를 완벽하게 지원하며, 이를 기반으로 자동화된 조치를 취하는 강력한 기능을 제공한다.

1.  **CloudWatch Metrics & Alarms (계기판과 경보 시스템):**
    CloudWatch는 AWS 리소스의 성능 데이터를 나타내는 **메트릭**의 타임 시리즈 데이터베이스다. EC2의 CPU 사용률, ALB의 요청 수 등 대부분의 기본 메트릭은 자동으로 수집된다. 우리는 여기에 더해 '주문 완료 수'와 같은 비즈니스 핵심 지표를 **사용자 지정 메트릭**으로 발행하여 기술과 비즈니스의 건강 상태를 함께 볼 수 있다.
    **CloudWatch 경보(Alarms)**는 이 메트릭 데이터를 24시간 감시하는 자동화된 감시병이다. "API의 5xx 에러율이 5분 동안 1%를 초과하면 즉시 운영팀에 알림을 보내라"와 같은 규칙을 설정하여, 인간의 개입 없이도 시스템이 스스로 문제를 감지하고 대응하도록 만들 수 있다.

2.  **CloudWatch Logs (모든 사건의 기록 보관소):**
    CloudWatch Logs는 우리의 애플리케이션과 AWS 서비스가 생성하는 모든 **로그** 데이터의 중앙 저장소 역할을 한다. Lambda 함수의 실행 로그부터 VPC의 네트워크 트래픽 로그까지, 모든 기록이 이곳에 집결한다.
    단순히 로그를 저장하는 것을 넘어, **CloudWatch Logs Insights**라는 강력한 쿼리 엔진을 통해 수십억 라인의 로그를 단 몇 초 만에 검색하고 분석할 수 있다. 이를 통해 "지난 1시간 동안 'OutOfMemory' 에러를 발생시킨 모든 주문 ID를 찾아라"와 같은 정밀한 분석으로 문제의 근본 원인을 신속하게 파악할 수 있다.

---

### AWS X-Ray: 요청의 여정을 밝히는 X선 🩺

CloudWatch가 시스템의 '무엇'이 문제고 '왜' 그런지에 대한 강력한 단서를 제공한다면, **AWS X-Ray**는 분산 환경에서 **'어디서'** 문제가 발생했는지 정확히 알려주는 **분산 추적(Distributed Tracing)** 서비스다. 마이크로서비스 아키텍처에서 단일 사용자 요청은 보이지 않는 여러 서비스 호출의 연쇄 반응으로 이루어진다. X-Ray는 이 복잡한 여정을 마치 X선 사진처럼 투명하게 보여준다.



* **작동 원리:** X-Ray는 애플리케이션에 SDK를 통합하여, 들어오는 모든 요청에 고유한 **추적 ID(Trace ID)**를 부여한다. 이 요청이 다른 서비스(다른 마이크로서비스, 데이터베이스, AWS API 등)를 호출할 때마다 이 추적 ID가 함께 전파된다. X-Ray는 이 ID를 가진 모든 작업 조각(**세그먼트, Segment**)들을 수집하여 하나의 완전한 여정(**트레이스, Trace**)으로 재구성한다.

* **서비스 맵과 병목 분석:** X-Ray의 가장 강력한 기능 중 하나는 수집된 트레이스 데이터를 기반으로 전체 아키텍처의 **서비스 맵(Service Map)**을 자동으로 그려주는 것이다. 이 맵을 통해 우리는 각 서비스 간의 호출 관계, 트래픽 양, 그리고 평균 응답 시간을 한눈에 파악할 수 있다. 만약 특정 노드(서비스)나 엣지(호출)가 주황색이나 빨간색으로 표시된다면, 바로 그곳이 우리 시스템의 병목 지점이자 장애의 진원지임을 직관적으로 알 수 있다.

* **통합의 힘:** X-Ray는 CloudWatch와 긴밀하게 통합되어 있다. X-Ray 트레이스 내에서 특정 서비스 호출에 대한 상세 로그로 직접 이동할 수 있으며, CloudWatch Logs Insights 쿼리 결과에 트레이스 ID를 포함시켜 특정 문제의 전체 컨텍스트를 한 번에 파악할 수도 있다.

CloudWatch와 X-Ray를 함께 사용함으로써 우리는 비로소 완전한 관측 가능성을 확보하게 된다. **CloudWatch**가 우리에게 "지금 열이 나고(메트릭), 환자가 어젯밤부터 아팠다고 말한다(로그)"는 정보를 준다면, **X-Ray**는 "자세히 보니 폐에 염증이 있다"고 문제의 정확한 위치를 짚어주는 것과 같다. 이 두 도구를 능숙하게 사용하는 것은, 복잡한 분산 시스템이라는 환자를 진단하고 치료하는 현대 클라우드 아키텍트의 필수적인 의술이다.