## 03. 장애 대응 훈련: 카오스 엔지니어링(Chaos Engineering)의 도입

우리는 이제 시스템의 건강 상태를 손금 보듯 들여다볼 수 있는 관측 가능성을 확보했고, 코드 변경 사항을 프로덕션까지 안전하게 전달하는 자동화된 CI/CD 파이프라인도 갖추었다. 우리의 시스템은 설계도 상으로는 완벽한 회복탄력성(Resilience)을 갖춘 것처럼 보인다. 다중 AZ에 걸쳐 리소스를 배포했고, Auto Scaling이 설정되어 있으며, 서킷 브레이커 패턴도 코드에 녹아들어 있다. 하지만 우리는 어떻게 확신할 수 있는가? 실제 프로덕션 환경의 예측 불가능한 혼돈 속에서, 이 모든 안전장치가 우리가 **가정한 대로** 정말 동작할 것이라고 어떻게 장담할 수 있는가?

"문제가 없기를 바라는 것"은 희망이지, 전략이 될 수 없다. 운영 우수성의 마지막 단계는 이 희망을 **검증된 자신감**으로 바꾸는 것이다. 이는 마치 정기적으로 소방 훈련을 실시하여 화재 경보기가 제대로 울리는지, 스프링클러가 작동하는지, 비상 대피로가 확보되어 있는지 직접 확인하는 것과 같다. 이 훈련의 클라우드 네이티브 버전이 바로 **카오스 엔지니어링(Chaos Engineering)**이다.

카오스 엔지니어링은 단순히 시스템을 무작위로 파괴하는 행위가 아니다. 이것은 **"프로덕션 환경에서 발생할 수 있는 혼란스러운 조건(Turbulent Conditions)을 통제된 방식으로 주입하는 실험을 통해, 시스템이 심각한 장애로 번지기 전에 그 약점을 발견하고 개선해나가는 과학적인 훈련법"**이다. 이는 질병을 예방하기 위해 약화된 바이러스를 주입하는 백신과 같은 원리다. 우리는 작은 실패를 의도적으로 경험함으로써, 치명적인 실패에 대한 면역력을 기르는 것이다.

---

### 카오스 엔지니어링의 과학적 실험 프로세스

성공적인 카오스 엔지니어링은 즉흥적인 파괴가 아닌, 다음과 같은 엄격한 과학적 실험의 형태를 따른다.



1.  **정상 상태(Steady State) 정의:** 먼저, 우리 시스템이 '건강하다'고 말할 수 있는 상태를 측정 가능한 지표(Metric)로 정의해야 한다. 예를 들어, "주문 API의 99퍼센타일 응답 시간은 200ms 미만이고, 에러율은 0.1% 미만을 유지한다"와 같은 것이다. 이 기준선은 우리의 CloudWatch 대시보드에서 명확하게 관찰 가능해야 한다.

2.  **가설(Hypothesis) 수립:** 시스템의 회복탄력성에 대한 가설을 세운다. 이 가설은 긍정적인 결과를 예측해야 한다. 예를 들어, **"주문 서비스의 EC2 인스턴스 중 하나가 예고 없이 종료되더라도, ALB의 헬스 체크와 Auto Scaling Group의 자동 복구 메커니즘 덕분에 사용자는 어떠한 에러도 경험하지 않으며, API 응답 시간은 10% 이상 증가하지 않을 것이다."**

3.  **실험 설계 및 실행 (장애 주입):** 가설을 검증하기 위해 실제와 같은 장애를 통제된 방식으로 주입한다. 이때, 잠재적인 영향 범위(Blast Radius)를 최소화하기 위해 처음에는 개발 환경에서 시작하여 점차 프로덕션 환경으로 확대하고, 특정 고객 그룹에게만 영향을 미치도록 범위를 제한하는 것이 중요하다. AWS는 이러한 실험을 안전하고 쉽게 실행할 수 있도록 **AWS Fault Injection Simulator(FIS)**라는 강력한 완전 관리형 서비스를 제공한다. FIS를 사용하면 "특정 Auto Scaling Group에 속한 인스턴스 중 하나를 무작위로 종료하라" 또는 "특정 마이크로서비스에 500ms의 지연 시간을 주입하라"와 같은 정교한 장애 시나리오를 코드로 정의하고 실행할 수 있다.

4.  **결과 검증 및 학습:** 실험이 진행되는 동안, 우리는 1단계에서 정의했던 정상 상태 지표를 면밀히 관찰한다.
    * **가설이 입증되었다면?** 우리 시스템의 회복탄력성에 대한 자신감을 얻게 된다.
    * **가설이 틀렸다면?** 이것이 바로 카오스 엔지니어링의 가장 큰 수확이다. Auto Scaling이 예상보다 느리게 반응했거나, 특정 의존성의 타임아웃 설정이 너무 길어서 장애가 전파되는 등, 우리가 미처 인지하지 못했던 시스템의 숨겨진 약점을 실제 장애가 발생하기 **전에** 발견한 것이다. 이제 우리는 이 약점을 보완하고, 같은 실험을 다시 반복하여 시스템을 더욱 견고하게 만든다.

---

### NextGen Commerce를 위한 FIS 실험 예제

* **실험:** 데이터베이스 장애 조치(Failover) 테스트
* **정상 상태:** 결제 API의 성공률 99.9% 이상, P99 응답 시간 300ms 미만.
* **가설:** "Aurora 데이터베이스 클러스터의 프라이머리 인스턴스에 장애가 발생하더라도, Aurora는 30초 이내에 리더(Reader) 인스턴스로 자동 장애 조치를 수행할 것이며, 이 시간 동안 결제 API는 일시적인 응답 지연만 경험할 뿐, 영구적인 실패로 이어지지는 않을 것이다."
* **FIS 실행:** `aws:rds:failover-db-cluster` 액션을 사용하여 Aurora 클러스터에 강제로 장애 조치를 트리거하는 FIS 실험 템플릿을 생성하고 실행한다.
* **검증:** 실험 중 CloudWatch 대시보드를 통해 결제 API의 에러율과 응답 시간을 실시간으로 모니터링하여 가설이 맞는지 확인한다.

카오스 엔지니어링은 '실패를 예상하고 설계하라(Design for Failure)'는 클라우드 네이티브의 핵심 철학을 실천하는 가장 능동적이고 확실한 방법이다. 이는 기술적인 실천을 넘어, 실패를 학습의 기회로 여기고, 가설 기반의 데이터 중심적 의사결정을 내리는 조직 문화를 구축하는 과정이다.

이제 우리는 시스템의 내부를 들여다보고(관측 가능성), 변화를 안전하게 적용하며(CI/CD), 미지의 혼돈 속에서도 살아남을 수 있다는 자신감(카오스 엔지니어링)을 얻었다. 운영 우수성이라는 단단한 갑옷을 입은 우리는, 이제부터 아키텍처의 가장 민감하고 중요한 부분인 보안, 안정성, 성능, 비용, 그리고 지속 가능성의 세계로 깊이 들어갈 준비를 마쳤다. 다음 장에서는 모든 것의 최우선 순위, '보안'을 향한 여정을 시작할 것이다.