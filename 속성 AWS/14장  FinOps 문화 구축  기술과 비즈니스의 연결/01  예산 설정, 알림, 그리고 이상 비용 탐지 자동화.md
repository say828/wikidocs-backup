## 01. 예산 설정, 알림, 그리고 이상 비용 탐지 자동화

FinOps의 핵심이 각 팀에게 재무적 책임과 권한을 위임하는 것이라면, 그 권한이 방만한 지출로 이어지지 않도록 막아주는 자동화된 **가드레일(Guardrail)**을 설치하는 것은 그에 상응하는 중요한 의무다. 매달 말일이 되어서야 지난달의 비용이 예산을 초과했다는 사실을 발견하는 것은, 이미 엎질러진 물을 보고 후회하는 것과 같다. 우리는 비용이 잘못된 방향으로 흐르기 시작하는 바로 그 순간을 포착하여, 관련된 팀에게 즉시 경고하고 조치를 취하도록 만드는 자동화된 피드백 루프를 구축해야 한다.

AWS는 이러한 재무적 가드레일을 구축하기 위한 두 가지 강력한 도구를 제공한다: 예측 가능한 초과 지출을 막는 **AWS Budgets**와, 예측 불가능한 이상 지출을 탐지하는 **AWS Cost Anomaly Detection**이다.

### 사전 예방적 가드레일: AWS Budgets

**AWS Budgets**는 우리가 사전에 정의한 예산을 기준으로, 실제 비용 또는 예상 비용이 임계값을 초과할 때 알림을 보내거나 특정 조치를 자동으로 실행하는 서비스다. 이는 마치 팀에게 예산이 설정된 법인카드를 주고, 한도의 80%가 소진되면 팀장에게 자동으로 경고 문자가 발송되도록 설정하는 것과 같다.

우리는 00절에서 정의한 태깅 전략을 사용하여 매우 정교한 예산을 설정할 수 있다. 예를 들어, '주문 서비스 팀(`Owner: order-service-team`)'이 사용하는 '개발 환경(`Environment: dev`)'의 월간 예산을 $500로 설정할 수 있다.

**AWS Budgets의 핵심 기능:**
* **다양한 예산 유형:** 단순히 총비용(Cost)뿐만 아니라, 특정 서비스의 사용량(Usage, 예: EC2 실행 시간), Savings Plans나 예약 인스턴스의 적용률(Coverage) 및 사용률(Utilization)에 대해서도 예산을 설정할 수 있다.
* **유연한 알림:** 예산의 80%, 100% 등 여러 임계값에서, 실제 비용뿐만 아니라 **예측 비용**이 임계값을 초과할 것으로 예상될 때도 미리 알림을 받을 수 있다. 이 예측 기반 알림은 월말이 되기 전에 미리 지출 속도를 조절할 기회를 제공한다.
* **자동화된 조치 (Budget Actions):** 알림을 보내는 것을 넘어, 예산이 초과되었을 때 특정 IAM 정책이나 서비스 제어 정책(SCP)을 적용하여 더 이상의 리소스 생성을 막는 것과 같은 강력한 자동화 조치를 실행할 수 있다. 예를 들어, 개발팀의 샌드박스 계정 예산이 초과되면, 새로운 EC2 인스턴스를 실행할 수 없도록 하는 정책을 해당 계정에 자동으로 적용하여 비용을 통제할 수 있다.

### 사후 대응적 안전망: AWS Cost Anomaly Detection

AWS Budgets가 예측 가능한 지출 패턴을 관리하는 데 효과적이라면, **AWS Cost Anomaly Detection**은 우리가 전혀 예상하지 못한, 비정상적인 비용 급증을 탐지하는 지능형 안전망이다. 이 서비스는 머신러닝을 사용하여 계정의 과거 비용 데이터를 학습하고, "정상적인" 지출 패턴의 기준선을 설정한다. 그리고 이 기준선에서 크게 벗어나는 이례적인 지출이 발생하면, 그 원인이 된 특정 서비스와 리전을 식별하여 경고를 보낸다.

이는 신용카드 회사가 평소 당신의 소비 패턴과 전혀 다른, 비정상적인 결제(예: 새벽 3시에 해외에서 발생한 대규모 결제)가 발생했을 때 즉시 사기 거래로 의심하고 당신에게 연락하는 것과 같다.

**Cost Anomaly Detection이 필요한 이유:**
* **숨겨진 비용 폭탄 탐지:** 개발자의 실수로 Lambda 함수가 무한 루프에 빠져 하룻밤 사이에 수백만 번 호출되거나, S3 버킷의 로깅 설정이 잘못되어 테라바이트급의 데이터가 쌓이는 등의 사고는 월간 예산으로는 며칠이 지나야만 발견할 수 있다. Cost Anomaly Detection은 이러한 이상 패턴을 몇 시간 내에 감지하여, 더 큰 재앙으로 번지기 전에 조치를 취할 수 있게 해준다.
* **근본 원인 분석:** 이상 비용이 탐지되면, Cost Anomaly Detection은 단순히 "EC2 비용이 급증했습니다"라고 알려주는 데 그치지 않고, "어제 `ap-northeast-2` 리전의 `c5.24xlarge` 인스턴스 사용량이 10,000% 증가한 것이 주요 원인입니다"와 같이 매우 구체적인 근본 원인 분석 정보를 함께 제공한다.



이 두 서비스를 결합하여 우리는 강력한 자동화된 FinOps 워크플로우를 구축할 수 있다. 모든 팀은 **AWS Budgets**를 통해 자신들의 예산을 스스로 책임지고 관리하며, **Cost Anomaly Detection**은 조직 전체의 재무적 리스크를 감시하는 중앙 관제 시스템 역할을 한다. 이 두 가드레일에서 발생하는 모든 알림은 각 팀의 슬랙(Slack) 채널이나 이메일로 즉시 전송되어, 비용 문제를 더 이상 재무팀의 골칫거리가 아닌, 해당 팀이 즉시 해결해야 할 운영 이벤트로 전환시킨다.

이제 우리는 비용을 실시간으로 추적하고 통제할 수 있는 자동화된 시스템을 갖추었다. 하지만 이 숫자들을 넘어서, 우리의 기술적 선택 하나하나가 회사의 손익계산서에 구체적으로 어떤 영향을 미치는지 이해할 수 있을까? 다음 절에서는 아키텍처 결정을 비즈니스 언어로 번역하는 기술을 탐구할 것이다.