## 01. 스트랭글러 피그(Strangler Fig) 패턴을 이용한 점진적 현대화

거대한 모놀리식 애플리케이션을 클라우드 네이티브로 재설계(Refactor)하기로 결정했을 때, 가장 큰 공포는 '어디서부터 시작해야 하는가'이다. 수백만 라인의 코드가 스파게티처럼 얽혀있는 시스템을 한 번에 재작성하려는 시도는, 마치 달리는 자동차의 엔진을 교체하려는 것과 같이 극도로 위험하고 실패할 확률이 높다. 우리는 이 거대한 괴물을 한입에 삼키려 해서는 안 된다. 대신, 우리는 열대 우림의 교살자 무화과(Strangler Fig) 나무처럼, 점진적이고 우아하게, 그리고 무엇보다 안전하게 낡은 시스템을 대체해야 한다.

**스트랭글러 피그 패턴**은 전설적인 소프트웨어 공학자 마틴 파울러(Martin Fowler)가 제안한 애플리케이션 현대화 전략으로, 그 이름처럼 교살자 무화과나무가 기존의 거대한 나무를 휘감으며 자라나, 결국에는 원래의 나무가 썩어 없어진 자리에 새로운 나무가 완전히 들어서는 자연의 과정에서 영감을 얻었다.



이 패턴의 핵심 철학은 **"새로운 시스템을 기존 시스템의 '옆에' 만들고, 점진적으로 트래픽을 새로운 시스템으로 전환하여, 결국에는 기존 시스템의 모든 기능이 새로운 시스템으로 대체되도록 하는 것"**이다. 이는 빅뱅 방식의 위험을 제거하고, 지속적으로 비즈니스 가치를 전달하면서도 통제된 방식으로 현대화를 진행할 수 있게 해준다.

### 스트랭글러 피그 패턴의 3단계 실행법

1.  **새로운 경로 식별 및 구축 (Identify & Build):** 먼저, 기존 모놀리식 시스템에서 비교적 독립적이면서도 비즈니스 가치가 높은 기능을 새로운 마이크로서비스로 분리할 첫 번째 대상을 식별한다. 예를 들어, 'NextGen Commerce' 모놀리식의 '상품 추천' 기능은 다른 핵심 기능(주문, 결제)과의 결합도가 낮으므로 좋은 첫 후보가 될 수 있다. 이 기능을 클라우드 네이티브 기술(예: Lambda, Amazon Personalize)을 사용하여 독립적인 마이크로서비스로 새로 구축한다.

2.  **트래픽 가로채기 및 라우팅 (Intercept & Route):** 여기가 바로 마법이 일어나는 지점이다. 우리는 기존 모놀리식 시스템의 바로 앞에 **스트랭글러 파사드(Strangler Façade)** 또는 **안티-커럽션 레이어(Anti-Corruption Layer)**라고 불리는 일종의 지능형 리버스 프록시(Reverse Proxy)를 배치한다. 처음에는 이 파사드가 모든 사용자 요청을 그대로 기존 모놀리식으로 통과시킨다.
    이제, 우리는 이 파사드에 새로운 라우팅 규칙을 추가한다: **"만약 상품 추천과 관련된 API 요청이 들어오면, 그 요청은 더 이상 모놀리식으로 보내지 말고, 새로 만든 '추천 마이크로서비스'로 보내라."** 이 파사드의 역할은 AWS에서는 API Gateway나 Application Load Balancer가 훌륭하게 수행할 수 있다.

3.  **교살 및 반복 (Strangle & Repeat):** 일단 '상품 추천' 기능이 새로운 마이크로서비스로 성공적으로 분리되어 안정적으로 운영되는 것이 확인되면, 우리는 기존 모놀리식 코드베이스에서 더 이상 사용되지 않는 낡은 추천 관련 코드를 **제거**할 수 있다. 이것이 바로 낡은 나무의 가지를 하나 잘라내는 '교살'의 과정이다.
    이제 우리는 이 과정을 **반복**한다. 다음 대상(예: '상품 검색 기능')을 식별하고, 새로운 마이크로서비스로 구축하며, 스트랭글러 파사드의 라우팅 규칙을 업데이트하여 트래픽을 전환한다. 이 과정을 수개월, 혹은 수년에 걸쳐 점진적으로 반복하다 보면, 어느 순간 기존 모놀리식에는 아무런 기능도 남아있지 않게 된다. 그때가 바로 우리가 낡고 거대한 모놀리식을 안전하게 전원 끌 수 있는 영광의 순간이다.

### 스트랭글러 피그 패턴의 축복

* **리스크 감소:** 한 번에 모든 것을 바꾸는 빅뱅 방식과 달리, 각 단계는 작고 통제된 변경이므로 실패 시의 영향 범위(Blast Radius)가 매우 작다. 문제가 발생하면 파사드의 라우팅 규칙을 되돌려 즉시 기존 시스템으로 롤백할 수 있다.
* **즉각적인 가치 전달:** 새로운 마이크로서비스는 처음부터 클라우드의 탄력성, 성능, 그리고 CI/CD의 이점을 누릴 수 있다. 전체 마이그레이션이 완료될 때까지 기다릴 필요 없이, 분리된 기능 하나하나가 비즈니스에 즉각적인 가치를 제공하기 시작한다.
* **점진적인 투자와 학습:** 거대한 초기 투자 없이, 조직의 역량과 비즈니스 우선순위에 맞춰 마이그레이션의 속도를 조절할 수 있다. 각 단계를 진행하며 팀은 마이크로서비스와 클라우드 네이티브 기술에 대한 경험을 점진적으로 쌓아나갈 수 있다.

스트랭글러 피그 패턴은 아키텍처 현대화를 위한 가장 현실적이고 강력한 전략이다. 하지만 이 우아한 패턴 뒤에는 항상 가장 어렵고 위험한 숙제가 숨어있다. 바로 모놀리식의 심장부에 얽혀있는 거대한 단일 데이터베이스를 어떻게 분리하고 마이그레이션할 것인가의 문제다. 다음 절에서는 이 마이그레이션의 가장 큰 난관, 데이터베이스 마이그레이션의 세계로 깊이 들어가 볼 것이다.