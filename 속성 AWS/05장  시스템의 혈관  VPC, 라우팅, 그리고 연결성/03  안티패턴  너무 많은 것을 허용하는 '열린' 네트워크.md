## 03. 안티패턴: 너무 많은 것을 허용하는 '열린' 네트워크

우리는 지금까지 VPC라는 견고한 성벽을 쌓고, 서브넷이라는 구획을 나누며, 라우팅 테이블과 보안 그룹이라는 정교한 통제 시스템을 구축하는 방법을 배웠다. 이 도구들은 제대로 사용하면 철옹성과 같은 보안을 제공하는 강력한 무기다. 하지만 모든 강력한 무기가 그렇듯, 잘못 사용하면 오히려 사용자 자신을 향하는 가장 위험한 흉기가 될 수 있다.

아키텍처 설계에서 안티패턴(Anti-pattern)이란, 표면적으로는 문제를 해결하는 것처럼 보이지만 실제로는 더 심각한 문제를 야기하는 흔한 나쁜 습관이나 해결책을 의미한다. 네트워크 설계에서의 안티패턴은 시스템의 가장 바깥쪽 방어선을 무너뜨려, 우리가 공들여 쌓아 올린 모든 보안 계층을 한순간에 무의미하게 만들 수 있다. 이 절에서는 수많은 클라우드 환경에서 반복적으로 발견되는, 그리고 반드시 피해야 할 가장 치명적인 네트워크 안티패턴을 해부하고 그에 대한 명확한 처방전을 제시한다.

### 첫 번째 죄악: `0.0.0.0/0`을 향한 맹목적인 믿음

보안 그룹 규칙에서 `0.0.0.0/0`이라는 CIDR 블록은 **"인터넷상의 그 어떤 IP 주소로부터의"**라는 의미를 갖는다. 이것은 가장 강력하고, 동시에 가장 위험한 규칙이다. 개발 과정에서 "일단 연결부터 되게 하자"는 생각으로, 혹은 귀찮다는 이유로 SSH(22번 포트), RDP(3389번 포트), 심지어 데이터베이스(3306, 5432번 포트)에 대해 `0.0.0.0/0`을 열어두는 것은, **우리 집의 모든 문과 창문의 자물쇠를 제거하고 "누구나 환영합니다"라는 팻말을 걸어두는 것과 정확히 같은 행위다.**



* **현실:** 당신이 `0.0.0.0/0`으로 SSH 포트를 여는 순간, 전 세계에 존재하는 수백만 개의 자동화된 스캐닝 봇은 1분 안에 당신의 서버를 발견하고 무차별 대입 공격(Brute-force attack)을 시작한다. 이것은 가정이 아니라, 인터넷의 현실이다.
* **잘못된 변명:** "비밀번호가 복잡해서 괜찮아.", "테스트 환경이라서 괜찮아." 하지만 인간은 실수하고, 테스트 환경의 취약점은 종종 프로덕션 환경으로 가는 지름길이 된다.
* **올바른 처방전:**
    * **서버 관리 접근:** 절대로 `0.0.0.0/0`을 사용하지 않는다. 사무실의 고정 IP 주소나, VPN을 통해서만 접근하도록 IP를 제한(`MyIP`)해야 한다. 더 나은 클라우드 네이티브 방식은 **AWS Systems Manager Session Manager**를 사용하는 것이다. Session Manager는 SSH 포트 자체를 열 필요 없이, IAM 권한만으로 브라우저나 AWS CLI를 통해 인스턴스에 안전하게 접근할 수 있게 해준다.
    * **웹 트래픽:** 사용자의 웹 트래픽을 받아야 하는 80(HTTP), 443(HTTPS) 포트에 대해서만 `0.0.0.0/0`을 허용하되, 이는 **EC2 인스턴스가 아닌 Application Load Balancer(ALB)의 보안 그룹**에만 적용해야 한다. EC2 인스턴스의 보안 그룹은 '오직 ALB의 보안 그룹으로부터의 트래픽만 허용'하도록 설정하여, 인스턴스가 인터넷에 직접 노출되는 것을 막아야 한다.

### 두 번째 죄악: 내부는 모두 안전하다는 착각

많은 아키텍트들이 외부 방어에는 신경 쓰면서도, 일단 VPC 내부에 들어온 트래픽은 모두 '신뢰할 수 있다'고 가정하는 실수를 저지른다. 예를 들어, VPC 내의 모든 EC2 인스턴스를 하나의 거대한 보안 그룹에 넣고, 그 보안 그룹 자신을 소스(`Source`)로 지정하여 모든 포트와 프로토콜의 통신을 허용(`All traffic`)하는 것이다.

이것은 **"우리 성 안에 있는 사람은 모두 착한 사람이다"**라는 순진한 믿음과 같다. 만약 외부의 공격자가 웹 서버(A) 하나를 침투하는 데 성공한다면 어떻게 될까? 이 공격자는 이제 아무런 제약 없이, 같은 보안 그룹 내에 있는 WAS(B), 데이터베이스(C), 그리고 다른 모든 서버로 자유롭게 이동하며 추가 공격을 감행할 수 있다. 이를 **측면 이동(Lateral Movement)**이라고 하며, 이는 내부 시스템 전체를 장악당하는 최악의 시나리오로 이어진다.

* **잘못된 설계:** 하나의 보안 그룹(`sg-all-internal`)이 Web, WAS, DB 서버에 모두 적용됨. 인바운드 규칙: `Source: sg-all-internal, Protocol: All, Port: All`.
* **올바른 처방전 (마이크로세그멘테이션):** **제로 트러스트(Zero Trust)** 원칙에 따라, 그 누구도 기본적으로 신뢰하지 않아야 한다. 각 애플리케이션 계층(Tier)은 자신만의 고유한 보안 그룹을 가져야 하며, 통신은 반드시 필요한 최소한의 포트와 프로토콜에 대해서만 명시적으로 허용되어야 한다.
    * **웹 서버 보안 그룹 (`sg-web`):** 소스 `0.0.0.0/0`으로부터 443 포트 허용.
    * **WAS 보안 그룹 (`sg-was`):** 소스 **`sg-web`**으로부터 8080 포트 허용.
    * **데이터베이스 보안 그룹 (`sg-db`):** 소스 **`sg-was`**으로부터 5432 포트 허용.

이처럼 보안 그룹을 참조하여 규칙을 만드는 것은, IP 주소가 아닌 논리적인 역할에 기반하여 방화벽을 구성하는 매우 강력하고 유연한 방법이다.

결론적으로, VPC 네트워킹의 핵심 철학은 **"기본적으로 모든 것을 거부하고(Default Deny), 반드시 필요한 것만 최소한으로 허용하라(Least Privilege)"**는 것이다. 편리함과의 타협은 곧 보안의 포기로 이어진다는 사실을 명심해야 한다.

이제 우리는 외부의 위협으로부터 시스템을 보호하고, 내부 트래픽을 정교하게 제어하는 견고한 혈관 시스템을 완성했다. 하지만 마이크로서비스 아키텍처에서 각 서비스들은 서로 어떻게 대화하고 데이터를 교환할까? 다음 장에서는 동기식 호출의 저주에서 벗어나 시스템의 회복탄력성과 확장성을 극대화하는 비동기 통신의 핵심, 즉 **분산 시스템의 접착제** 역할을 하는 SQS, SNS, EventBridge의 세계로 여정을 떠날 것이다.