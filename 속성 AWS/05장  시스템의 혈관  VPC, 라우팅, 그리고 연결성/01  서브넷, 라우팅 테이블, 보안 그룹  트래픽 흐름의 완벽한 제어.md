## 01. 서브넷, 라우팅 테이블, 보안 그룹: 트래픽 흐름의 완벽한 제어

VPC라는 거대한 사유지의 경계를 정했다면, 이제 그 내부를 효율적으로 사용하기 위해 구획을 나누어야 한다. 아무 계획 없이 모든 건물을 한곳에 욱여넣는다면 동선이 꼬이고 보안에 취약한 난개발이 될 뿐이다. **서브넷(Subnet)**은 VPC라는 큰 땅을 더 작은 필지로 나누는 행위이며, 이는 우리의 아키텍처를 논리적으로 구성하고 보안 경계를 설정하는 가장 기본적인 단계다.

이는 마치 도시를 계획할 때 주거 지역, 상업 지역, 공업 지역으로 용도에 맞게 구역(Zone)을 나누는 것과 같다. 우리는 이 구획된 땅(서브넷) 위에 우리의 리소스(EC2 인스턴스, 데이터베이스 등)를 배치하게 된다.

### 서브넷: 목적에 따른 땅의 분할

가장 중요한 서브넷의 구분 기준은 **'인터넷과의 연결성'**이다. 이를 기준으로 우리는 서브넷을 크게 두 종류, **퍼블릭(Public)**과 **프라이빗(Private)**으로 나눈다.

* **퍼블릭 서브넷 (상업 지역):** 외부 인터넷과 직접적으로 통신해야 하는 리소스를 위한 공간이다. 웹 서버처럼 불특정 다수의 사용자가 접근해야 하는 리소스가 이곳에 위치한다. 이곳은 외부로 활짝 열린 창구이자, 동시에 외부의 위협에 직접적으로 노출되는 최전선이기도 하다.
* **프라이빗 서브넷 (주거/공업 지역):** 애플리케이션의 핵심 로직을 처리하는 WAS(Web Application Server)나, 가장 민감한 데이터를 보관하는 데이터베이스처럼 외부 인터넷에서 직접 접근할 필요가 없거나, 절대로 접근해서는 안 되는 리소스를 위한 안전한 내부 공간이다.

이러한 분리는 보안의 핵심 원칙인 **심층 방어(Defense in Depth)**의 시작이다. 해커가 웹 서버(퍼블릭 서브넷)를 침해하더라도, 데이터베이스(프라이빗 서브넷)까지 도달하려면 또 다른 보안 계층을 뚫어야 하므로, 핵심 자산을 보호할 수 있는 시간을 벌 수 있다.

### 라우팅 테이블: 서브넷의 교통 경찰

서브넷을 나누는 것만으로는 트래픽이 어디로 가야 할지 알 수 없다. 각 서브넷에는 반드시 **라우팅 테이블(Route Table)**이라는 교통 표지판이 연결되어야 한다. 라우팅 테이블은 아주 단순한 규칙들의 집합이다: **"목적지가 [어디]인 트래픽은 [이쪽]으로 보내라."**



* **퍼블릭 서브넷의 라우팅 테이블:** "목적지가 VPC 내부(`10.0.0.0/16`)가 아닌 **모든 외부 트래픽(`0.0.0.0/0`)**은 **인터넷 게이트웨이(Internet Gateway)**라는 대문으로 보내라." 이 규칙 하나가 바로 서브넷을 '퍼블릭'하게 만드는 핵심이다.
* **프라이빗 서브넷의 라우팅 테이블:** 기본적으로 외부로 나가는 경로가 없다. 만약 이 서브넷의 인스턴스가 OS 패치 다운로드처럼 외부 인터넷으로 '나가기만' 해야 한다면, "모든 외부 트래픽(`0.0.0.0/0`)은 **NAT 게이트웨이(NAT Gateway)**로 보내라"는 규칙을 추가한다. NAT 게이트웨이는 내부 IP 주소를 외부 공인 IP로 변환해주어 외부로의 통신은 허용하지만, 외부에서 먼저 시작된 연결은 차단하는 역할을 한다.

### 보안 그룹과 네트워크 ACL: 2단계 경호 시스템

이제 트래픽이 올바른 경로를 따라 리소스 앞까지 도착했다. 하지만 누가 이 리소스의 문을 열고 들어올 수 있는지 허가하는 마지막 관문이 남아있다. VPC는 이를 위해 두 가지 종류의 방화벽, 즉 **보안 그룹(Security Group)**과 **네트워크 ACL(Access Control List)**이라는 강력한 2단계 경호 시스템을 제공한다.

1.  **보안 그룹 (Security Group) - 건물의 경호원:**
    * **작동 수준:** 개별 인스턴스(EC2, RDS 등)의 네트워크 인터페이스에 직접 적용되는 **상태 저장(Stateful)** 방화벽이다.
    * **규칙:** **허용(Allow) 규칙만**을 가질 수 있다. 기본적으로 모든 인바운드 트래픽은 차단되며, 명시적으로 허용한 트래픽만 들어올 수 있다.
    * **핵심 특징 (Stateful):** '상태 저장'이라는 말은, 일단 인바운드 요청이 허용되면 그에 대한 **아웃바운드 응답 트래픽은 규칙과 상관없이 자동으로 허용**된다는 의미다. 우리가 웹 서버에 80번 포트(HTTP)로 들어오는 것을 허용했다면, 사용자의 요청에 대한 웹 페이지 응답이 나가는 것은 별도의 아웃바운드 규칙 없이도 자동으로 허용된다. 이는 방화벽 규칙 관리를 매우 편리하게 만든다.

2.  **네트워크 ACL (Network ACL) - 동네의 방범대원:**
    * **작동 수준:** **서브넷** 전체에 적용되는 **상태 비저장(Stateless)** 방화벽이다.
    * **규칙:** **허용(Allow)과 거부(Deny) 규칙을 모두** 가질 수 있다. 규칙 번호가 낮은 순서대로 적용된다.
    * **핵심 특징 (Stateless):** '상태 비저장'이라는 말은, 인바운드 트래픽과 아웃바운드 트래픽을 완전히 **별개로 판단**한다는 의미다. 인바운드로 80번 포트를 허용했더라도, 그에 대한 응답이 밖으로 나가기 위해서는 아웃바운드 규칙에서 해당 포트 대역(주로 1024-65535)을 명시적으로 허용해주어야만 한다. 이는 규칙을 더 복잡하게 만들지만, 더 세밀한 제어를 가능하게 한다.

**[도표: 보안 그룹 vs 네트워크 ACL 비교]**

| 구분 | 보안 그룹 (Security Group) | 네트워크 ACL (Network ACL) |
| :--- | :--- | :--- |
| **적용 대상** | 인스턴스 (EC2, RDS 등) | 서브넷 |
| **상태** | **Stateful** (응답은 자동 허용) | **Stateless** (인/아웃바운드 별도 규칙 필요) |
| **규칙 종류** | 허용(Allow) 규칙만 가능 | 허용(Allow) 및 거부(Deny) 규칙 모두 가능 |
| **일반적 용도**| 애플리케이션 계층의 세밀한 접근 제어 | 서브넷 경계의 광범위한 트래픽 필터링 (블랙리스트 등) |

대부분의 경우, 우리는 **보안 그룹**만으로도 충분하고 직관적인 보안 제어를 할 수 있다. 예를 들어, WAS(Web Application Server)의 보안 그룹에는 '오직 웹 서버 보안 그룹으로부터의 8080 포트 트래픽만 허용'이라는 규칙을, 데이터베이스의 보안 그룹에는 '오직 WAS 보안 그룹으로부터의 5432 포트 트래픽만 허용'이라는 규칙을 설정함으로써, 서비스 간의 통신을 최소 권한 원칙에 따라 완벽하게 통제할 수 있다. 네트워크 ACL은 기본값(모든 트래픽 허용)으로 두되, 특정 악의적인 IP 대역 전체를 서브넷 수준에서 차단해야 하는 특수한 경우에 사용하는 것이 일반적인 모범 사례다.

VPC, 서브넷, 라우팅 테이블, 보안 그룹, 그리고 네트워크 ACL. 이 다섯 가지 구성 요소는 우리 시스템의 혈액 순환을 관장하는 핵심이다. 이들을 어떻게 설계하고 조합하느냐에 따라, 우리의 아키텍처는 외부의 위협으로부터 안전하고, 내부적으로는 효율적으로 흐르는 건강한 생명체가 될 수도, 혈관이 막히고 동맥경화를 앓는 병든 시스템이 될 수도 있다. 이제, 이 내부 시스템이 외부 세계와 어떻게 연결되고 소통하는지, 그 관문들을 살펴볼 시간이다.