## 01. Amazon CloudFront(CDN)를 활용한 글로벌 지연 시간 단축

우리는 10장 서두에서 워크로드에 최적화된 EC2 인스턴스와 EBS 볼륨을 선택하여 서버 내부의 처리 속도를 극대화하는 방법을 배웠다. 하지만 우리의 'NextGen Commerce' 플랫폼이 아무리 빠른 엔진을 장착했다 한들, 서울에 있는 서버에서 미국 뉴욕에 있는 고객까지 데이터를 전달하는 데 걸리는 시간은 어떻게 단축할 수 있을까? 여기에는 우리가 거스를 수 없는 우주의 물리 법칙, 즉 **빛의 속도**라는 한계가 존재한다. 서울에서 뉴욕까지의 물리적 거리가 만들어내는 **지연 시간(Latency)**은 서버의 성능만으로는 절대 해결할 수 없는 문제다.

이 물리적 거리의 장벽을 허물기 위해, 우리는 **콘텐츠 전송 네트워크(Content Delivery Network, CDN)**라는 마법을 사용해야 한다. CDN의 기본 원리는 지극히 단순하고 강력하다: **"데이터를 사용자에게서 가장 가까운 곳으로 미리 옮겨 놓는다."** 이는 마치 전 세계 고객들이 서울에 있는 본점 레스토랑까지 비행기를 타고 올 필요 없이, 각자의 도시에 있는 프랜차이즈 지점에서 동일한 품질의 음식을 즐기게 하는 것과 같다. AWS에서 이 프랜차이즈 네트워크의 역할을 하는 것이 바로 **Amazon CloudFront**다.

CloudFront는 전 세계 수백 개의 **엣지 로케이션(Edge Location)** 또는 **PoP(Point of Presence)**라는 전초기지로 구성된 거대한 글로벌 네트워크다. 이 엣지 로케이션들은 주요 도시의 인터넷 교환 지점(IXP)에 위치하여, 전 세계 거의 모든 사용자가 AWS 네트워크에 매우 낮은 지연 시간으로 접속할 수 있도록 해준다.

### CloudFront의 작동 원리: 캐싱과 오리진

CloudFront의 마법은 **캐싱(Caching)**이라는 기술을 통해 이루어진다.



1.  **최초 요청 (Cache Miss):** 뉴욕에 있는 사용자가 'NextGen Commerce'의 상품 이미지(`product-A.jpg`)를 요청한다. 이 요청은 DNS에 의해 사용자에게서 가장 가까운 뉴욕의 CloudFront 엣지 로케이션으로 라우팅된다.
2.  엣지 로케이션은 자신의 캐시에 해당 이미지가 있는지 확인한다. 이것이 이 지역에서의 첫 요청이라면, 당연히 캐시에는 아무것도 없다. 이를 **캐시 미스(Cache Miss)**라고 한다.
3.  **오리진(Origin)으로부터 가져오기:** 엣지 로케이션은 서울 리전에 있는 우리의 **오리진(Origin)** 서버—이 경우, 이미지가 저장된 S3 버킷 또는 ALB—로 해당 이미지를 요청한다.
4.  **캐시에 저장 및 사용자에게 응답:** 오리진 서버는 엣지 로케이션으로 `product-A.jpg`를 전송한다. 엣지 로케이션은 이 이미지를 사용자에게 전달하는 동시에, 자신의 캐시 저장소에 사본을 저장한다. 이때, 이 사본이 얼마나 오랫동안 유효할지를 나타내는 **TTL(Time-To-Live)** 값이 함께 기록된다.

5.  **이후의 요청 (Cache Hit):** 잠시 후, 뉴저지에 있는 다른 사용자가 동일한 이미지를 요청한다. 이 요청 역시 뉴욕의 엣지 로케이션으로 라우팅된다. 이번에는 캐시에 이미지의 유효한 사본이 존재한다. 이를 **캐시 히트(Cache Hit)**라고 한다.
6.  엣지 로케이션은 더 이상 서울의 오리진 서버까지 갈 필요 없이, 즉시 캐시에서 이미지를 꺼내 사용자에게 응답한다. 이 응답은 수십 밀리초(ms) 이내에 이루어지며, 사용자는 거의 즉각적으로 이미지를 볼 수 있게 된다.

### 정적 콘텐츠를 넘어 동적 콘텐츠 가속까지

CloudFront의 가장 명백한 용도는 이미지, 동영상, CSS, JavaScript 파일과 같은 **정적 콘텐츠(Static Content)**를 캐싱하는 것이다. 이를 통해 우리는 오리진 서버의 부하를 극적으로 줄이고, 글로벌 사용자에게 빠른 로딩 속도를 제공할 수 있다.

하지만 CloudFront의 진정한 힘은 **동적 콘텐츠(Dynamic Content)**, 즉 API 요청의 성능을 가속하는 능력에 있다. API 응답은 사용자마다 내용이 다르므로 캐싱할 수 없는데 어떻게 성능을 향상시킬 수 있을까? 그 비밀은 **AWS의 최적화된 글로벌 백본 네트워크**에 있다. 사용자가 뉴욕에서 보낸 API 요청은 가장 가까운 엣지 로케이션에서 AWS 네트워크로 들어온다. 그리고 혼잡하고 예측 불가능한 공용 인터넷을 우회하여, 오직 AWS만이 관리하는 안정적이고 빠른 프라이빗 백본망을 통해 서울의 오리진 서버까지 전달된다. 이는 TCP 연결 설정과 TLS 핸드셰이크에 걸리는 시간을 크게 단축시켜, 캐싱이 불가능한 동적 요청의 응답 시간마저도 의미 있게 개선한다.

또한, 8장에서 다루었듯이, CloudFront는 **AWS WAF**와 **Shield**를 통합하기 위한 가장 이상적인 최전선이다. 모든 트래픽이 CloudFront 엣지에서 먼저 검사되므로, DDoS 공격이나 SQL 인젝션과 같은 악의적인 요청이 우리의 소중한 오리진 서버에 도달하기 전에 차단된다.

결론적으로, 글로벌 서비스를 지향하는 'NextGen Commerce'와 같은 애플리케이션에게 CloudFront는 선택 사항이 아닌 **필수 아키텍처 구성 요소**다. 이는 단순히 이미지를 빠르게 로딩하는 도구를 넘어, 전 세계 사용자에게 쾌적한 경험을 제공하고, 오리진 인프라의 부하와 비용을 절감하며, 보안을 강화하는 다목적 성능 효율성 플랫폼이다.

이제 우리는 지리적 거리의 한계를 극복했다. 하지만 성능 병목은 종종 우리에게 가장 가까운 곳, 바로 데이터베이스에서 발생한다. 다음 절에서는 시스템의 심장부인 데이터베이스의 성능을 쥐어짜는 구체적인 튜닝 기술들을 탐구할 것이다.