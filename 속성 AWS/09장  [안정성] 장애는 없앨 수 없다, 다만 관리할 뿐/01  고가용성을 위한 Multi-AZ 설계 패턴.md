## 01. 고가용성을 위한 Multi-AZ 설계 패턴

단일 장애점(SPOF)을 제거하기 위한 가장 근본적이고 강력한 전략은 인프라 자체를 물리적으로 분리된 여러 위치에 중복하여 배포하는 것이다. AWS는 이를 위해 **가용 영역(Availability Zone, AZ)**이라는 개념을 제공한다. 많은 이들이 AZ를 단순히 '데이터 센터'와 동일시하지만, 그 의미는 훨씬 더 깊다. 가용 영역은 하나의 AWS 리전(Region, 예: 서울) 내에 존재하는, **독립적인 전력, 냉각, 네트워크 설비를 갖춘 하나 이상의 격리된 데이터 센터 집합**이다. 즉, `ap-northeast-2a`와 `ap-northeast-2c`는 물리적으로 수 킬로미터 이상 떨어져 있어, 한 곳에 화재나 홍수와 같은 재해가 발생하더라도 다른 한 곳은 영향을 받지 않도록 설계되었다. 그러면서도 이 AZ들은 AWS가 관리하는 초고속, 저지연의 전용 네트워크로 연결되어 있어 마치 하나의 데이터 센터처럼 작동한다.

**다중 AZ(Multi-AZ)** 설계 패턴의 핵심은 바로 이 물리적 격리를 활용하는 것이다. 우리 시스템의 핵심 구성 요소들을 최소 두 개 이상의 가용 영역에 걸쳐 분산 배치함으로써, 우리는 가용 영역 하나가 통째로 마비되는 최악의 시나리오에서도 서비스의 연속성을 보장할 수 있다. 이는 우리가 제거해야 할 가장 큰 SPOF 중 하나인 '단일 가용 영역'이라는 위험을 제거하는 행위다.

'NextGen Commerce' 아키텍처에 이 패턴을 적용하는 것은 다음과 같다.



1.  **컴퓨팅 계층 (Web/Application Tier):**
    * 우리의 웹 서버와 WAS를 실행하는 **Auto Scaling Group**은 `ap-northeast-2a`와 `ap-northeast-2c` 두 가용 영역 모두에 걸쳐 EC2 인스턴스를 시작하도록 설정되어야 한다.
    * 이 인스턴스들 앞에 위치하는 **Application Load Balancer(ALB)** 역시 두 가용 영역 모두에서 활성화되어야 한다. 이렇게 하면, ALB는 `2a` AZ의 인스턴스들과 `2c` AZ의 인스턴스들 양쪽에 트래픽을 고르게 분산시킨다. 만약 `2a` AZ 전체에 장애가 발생하면, ALB의 헬스 체크가 `2a`의 모든 인스턴스가 비정상임을 감지하고, **자동으로 모든 트래픽을 `2c` AZ의 건강한 인스턴스들로만 보내게 된다.** 사용자는 이 모든 과정이 일어나는 동안 아무런 중단도 느끼지 못할 것이다.

2.  **데이터 계층 (Database Tier):**
    데이터베이스는 상태를 저장(Stateful)하기 때문에 컴퓨팅 계층보다 다중 AZ 구성이 더 복잡하다. 하지만 AWS의 관리형 서비스는 이 복잡성을 거의 완벽하게 추상화해준다.
    * **Amazon RDS/Aurora:** 데이터베이스를 생성할 때 **"다중 AZ 배포(Multi-AZ deployment)"** 옵션을 선택하는 것만으로, AWS는 자동으로 주 데이터베이스(Primary) 인스턴스와는 다른 AZ에 **동기식(Synchronous)**으로 복제되는 대기(Standby) 인스턴스를 생성하고 관리한다. 주 인스턴스에 장애가 발생하면, RDS는 **수십 초 이내에 자동으로 DNS 엔드포인트를 대기 인스턴스로 변경**하여 장애 조치(Failover)를 완료한다. 우리는 애플리케이션 코드 수정 없이도 데이터베이스의 고가용성을 확보할 수 있다.
    * **Amazon ElastiCache for Redis:** Redis 클러스터를 생성할 때 "다중 AZ" 옵션을 활성화하면, 주 노드(Primary Node)가 다른 AZ에 있는 복제 노드(Replica Nodes)로 데이터를 비동기적으로 복제한다. 주 노드에 장애가 발생하면, ElastiCache는 자동으로 복제 노드 중 하나를 새로운 주 노드로 승격시켜 서비스를 지속한다.

### 다중 AZ의 대가: 비용과 성능

물론 이러한 높은 수준의 안정성은 공짜가 아니다. 모든 것을 이중으로 구성하는 것은 필연적으로 비용 증가를 수반한다. 대기 상태의 RDS 인스턴스에도 비용이 발생하며, 서로 다른 AZ 간에 데이터를 전송할 때마다 약간의 데이터 전송 비용이 발생한다. 또한, 동기식으로 데이터를 복제하는 데이터베이스의 경우, 쓰기 작업에 약간의 지연 시간(Latency)이 추가될 수 있다.

하지만 이 비용은, 장애로 인해 비즈니스가 중단되었을 때 발생하는 막대한 손실(매출 손실, 브랜드 신뢰도 하락 등)에 비하면 매우 저렴한 보험료와 같다. 아키텍트는 비즈니스의 **복구 시간 목표(RTO)**와 **복구 지점 목표(RPO)**를 명확히 이해하고, 이 비용과 안정성 사이의 트레이드오프를 현명하게 결정해야 한다.

다중 AZ 설계는 인프라 수준의 재해로부터 우리를 보호하는 강력한 토대를 제공한다. 하지만 이 토대 위에서 개별 인스턴스들의 장애를 감지하고, 수요 변화에 따라 동적으로 그 수를 조절하는 자동화된 메커니즘이 없다면, 이 구조는 정적인 방어벽에 불과할 것이다. 이제, 이 시스템에 스스로를 치유하고 진화하는 생명력을 불어넣을 Auto Scaling과 Load Balancing의 세계로 나아가자.