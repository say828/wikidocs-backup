## 03. FIRST 원칙: 좋은 테스트가 갖추어야 할 5가지 핵심 속성

우리는 TDD의 리듬(`Red-Green-Refactor`)과 전략(`Test Pyramid`), 그리고 두 가지 접근법(`Classicist vs London School`)을 배웠다. 이제 우리가 작성하는 개별 테스트 코드의 품질을 보장하는 구체적인 원칙을 알아볼 차례다. 좋은 테스트는 우연히 만들어지지 않는다. 그것은 의식적인 노력과 잘 정립된 원칙의 산물이다.

**FIRST**는 Robert C. Martin이 저서 *Clean Code*에서 제안한, 훌륭한 단위 테스트가 갖춰야 할 5가지 핵심 속성을 나타내는 두문자어(acronym)다. 이 원칙들을 따르는 테스트는 시간이 지나도 팀의 자산으로 남지만, 이를 위반하는 테스트는 금세 기술 부채와 골칫덩어리로 전락한다.

---

### **F: Fast (빠르게)**

* **원칙:** 테스트는 빠르게 실행되어야 한다. 이상적으로는 수천 개의 단위 테스트가 수 초 내에 완료되어야 한다.
* **이유:** TDD의 핵심은 짧은 피드백 루프다. 테스트 실행이 느려지면 개발자는 자연스럽게 테스트 실행을 꺼리게 되고, `Red-Green-Refactor` 사이클의 리듬이 깨진다. 몇 분씩 걸리는 테스트 스위트는 개발자의 흐름을 끊고 생산성을 저하시킨다. 결국, 느린 테스트는 실행되지 않는 테스트가 되고, 실행되지 않는 테스트는 없는 것과 같다.
* **실천 방안:** 테스트는 데이터베이스, 네트워크, 파일 시스템 등 느린 외부 자원에 직접 의존해서는 안 된다. 이것이 바로 단위 테스트가 외부 의존성을 격리(mocking)하는 주된 이유 중 하나다.

### **I: Independent/Isolated (독립적으로/격리되어)**

* **원칙:** 각각의 테스트는 서로 독립적이어야 하며, 어떤 순서로 실행되더라도 결과에 영향을 주지 않아야 한다.
* **이유:** 만약 `testA()`가 성공해야만 `testB()`가 성공할 수 있다면, `testA()`가 실패했을 때 `testB()`까지 연쇄적으로 실패하게 된다. 이는 실패의 진짜 원인을 파악하기 어렵게 만드는 '노이즈'를 발생시킨다. 하나의 버그가 수십 개의 테스트 실패를 유발하는 상황은 디버깅을 악몽으로 만든다. 모든 테스트는 자신만의 깨끗한 환경에서 실행되고 종료되어야 한다.
* **실천 방안:** 각 테스트는 필요한 모든 데이터를 스스로 준비해야 한다(`given` 블록). 한 테스트가 남긴 데이터나 상태(side-effect)를 다른 테스트가 사용해서는 절대 안 된다. 테스트 프레임워크의 `BeforeEach`나 `AfterEach` 같은 기능을 활용하여 매번 독립적인 환경을 구축해야 한다.

### **R: Repeatable (반복 가능하게)**

* **원칙:** 테스트는 어떤 환경(로컬 머신, CI 서버 등)에서도, 언제 실행하더라도 항상 동일한 결과를 반환해야 한다.
* **이유:** 어떨 때는 성공하고 어떨 때는 실패하는 테스트, 이른바 '변덕스러운 테스트(Flaky Test)'는 테스트 스위트 전체의 신뢰도를 파괴하는 암적인 존재다. 개발자들은 점차 실패를 무시하기 시작하며, 진짜 중요한 버그가 발생했을 때도 "아, 또 그 변덕스러운 테스트 때문이겠지"라며 외면하게 된다.
* **실천 방안:** 테스트는 현재 날짜/시간, 임의의 숫자(Randomness), 외부 시스템의 현재 상태 등 비결정적인 요소에 의존해서는 안 된다. 이러한 요소들은 테스트 더블이나 고정된 값으로 대체하여 테스트의 실행 결과를 항상 예측 가능하게 만들어야 한다.

### **S: Self-validating (스스로 검증 가능하게)**

* **원칙:** 테스트는 실행 결과가 명확하게 성공(pass) 또는 실패(fail)로 끝나야 한다. 사람의 수동적인 해석이 개입되어서는 안 된다.
* **이유:** 테스트의 결과물을 확인하기 위해 로그 파일을 열어보거나, 콘솔에 출력된 값을 눈으로 비교해야 한다면 그것은 자동화된 테스트가 아니다. 테스트의 목적은 프로세스를 자동화하여 인간의 실수를 줄이는 것이다.
* **실천 방안:** 모든 테스트는 `assertEquals`, `assertTrue`와 같은 단언(assertion) 구문으로 끝나야 한다. 테스트 프레임워크가 이 단언문의 성공/실패 여부를 자동으로 판단하여 명확한 결과를 보고하도록 만들어야 한다.

### **T: Timely (시기적절하게)**

* **원칙:** 테스트는 테스트하려는 프로덕션 코드보다 먼저, 또는 거의 동시에 작성되어야 한다.
* **이유:** 이것은 TDD의 핵심 그 자체다. 테스트를 먼저 작성하면 자연스럽게 테스트하기 좋은 설계(testable design)를 고민하게 된다. 반면, 프로덕션 코드를 모두 작성한 뒤에 테스트를 추가하려고 하면, 이미 코드는 강하게 결합되어 있거나 테스트하기 어려운 구조로 굳어진 경우가 많다. 결국 테스트 작성을 포기하거나, 중요하지 않은 부분만 겨우 테스트하는 결과를 낳는다.
* **실천 방안:** `Red-Green-Refactor` 사이클을 충실히 따른다. 프로덕션 코드를 작성하기 전에, 그 코드가 해야 할 일을 정의하는 실패하는 테스트부터 작성하는 습관을 들여야 한다.

---

이 **FIRST** 원칙은 우리가 작성하는 모든 테스트 코드의 품질을 측정하는 훌륭한 척도다. 앞으로 이 책에서 작성하는 모든 테스트는 이 다섯 가지 원칙을 만족시키는 것을 목표로 할 것이다.