## 02\. SINGLE\_TABLE (단일 테이블 전략): 단순함과 NULL의 대가

\*\*단일 테이블 전략(Single Table Strategy)\*\*은 조인 전략과 정반대의 접근법을 취한다. 이름 그대로, 상속 계층에 있는 **모든 클래스를 단 하나의 테이블**에 통합하여 표현한다. 이 전략의 핵심 키워드는 '단순함'과 '성능'이지만, 그 대가로 데이터베이스의 정규성과 저장 공간을 희생해야 한다.

-----

### **매핑 코드와 테이블 구조**

단일 테이블 전략을 사용하려면 부모 클래스에 `@Inheritance(strategy = InheritanceType.SINGLE_TABLE)`을 명시한다. 이 전략에서는 어떤 로우(row)가 어떤 자식 클래스에 해당하는지 구분해야 하므로, **`@DiscriminatorColumn`이 필수적으로 사용**된다.

**Item.kt (부모)**

```kotlin
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "DTYPE") // 이 전략에서는 필수로 사용해야 한다.
abstract class Item(
    @Id @GeneratedValue
    val id: Long = 0,
    var name: String,
    var price: Int
)
```

자식 클래스(`Book`, `Album`)의 코드는 조인 전략과 동일하다.

**생성되는 테이블 구조**
[그림: 단일 테이블 전략의 테이블 구조]
이 매핑을 통해 JPA는 단 하나의, 모든 컬럼을 가진 '슈퍼 테이블'을 생성한다.

**ITEM (단일 테이블)**
| ID (PK) | DTYPE | NAME | PRICE | AUTHOR | ISBN | ARTIST |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | Book | JPA 정복 | 35000 | 김영한 | 123-456| `NULL` |
| 2 | Album| BTS 앨범 | 28000 | `NULL` | `NULL` | BTS |

`Book` 타입의 로우는 `ARTIST` 컬럼이 `NULL`이 되고, `Album` 타입의 로우는 `AUTHOR`와 `ISBN` 컬럼이 `NULL`이 된다. 이처럼 자신에게 해당하지 않는 속성들은 모두 `NULL` 값으로 채워진다.

-----

### **장점과 단점**

**장점:**

1.  **압도적인 조회 성능**: 데이터를 조회할 때 **조인(JOIN)이 전혀 필요 없다.** 단일 테이블에서 `WHERE` 절로 `DTYPE`을 필터링하여 한 번에 조회하므로, 세 가지 전략 중 조회 성능이 가장 빠르다.
2.  **단순한 쿼리**: 조회뿐만 아니라 데이터 등록(`INSERT`)도 단 하나의 SQL로 처리되므로 쿼리가 매우 단순하다.

**단점:**

1.  **데이터 중복 및 저장 공간 낭비**: 자식 클래스가 많고 각각의 고유 속성이 많아질수록 테이블에는 **엄청난 수의 `NULL` 값이 발생**한다. 이는 데이터베이스 저장 공간을 낭비하는 결과를 낳는다.
2.  **스키마 확장 및 제약조건의 한계**:
      * 자식 클래스에 새로운 필드를 하나 추가하려면, 이 거대한 단일 테이블 전체에 대한 `ALTER TABLE` 작업이 필요하여 부담이 크다.
      * `Book`의 `author` 필드는 반드시 값이 있어야 하는 `NOT NULL` 필드여야 하지만, 데이터베이스 컬럼 레벨에서는 `NOT NULL` 제약조건을 걸 수 없다. `Album` 타입의 로우는 `author`가 `NULL`이어야 하기 때문이다. 모든 제약조건을 애플리케이션 레벨에서 처리해야 하는 부담이 생긴다.

-----

단일 테이블 전략은 단순함과 조회 성능이라는 확실한 장점을 가지고 있다. 상속 구조가 복잡하지 않고, 자식 클래스들의 개별 속성이 많지 않으며, 무엇보다 조회 성능이 시스템의 가장 중요한 요구사항일 때 고려해 볼 수 있는 강력한 선택지다. 이제 마지막 전략으로, 실무에서는 거의 추천되지 않는 클래스별 테이블 전략에 대해 알아보자.