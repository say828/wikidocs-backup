## RDBMS vs. NoSQL: 이커머스 각 도메인에 적합한 DB 선택 가이드

`Database per Service` 패턴을 채택하는 순간, 우리는 모든 서비스가 똑같은 데이터베이스 기술을 사용해야 하는 족쇄에서 벗어나게 됩니다. 그리고 "각 서비스의 고유한 요구사항에 가장 적합한 데이터베이스는 무엇인가?"라는 행복한 고민을 시작할 수 있습니다. 이것이 바로 \*\*폴리글랏 퍼시스턴스(Polyglot Persistence)\*\*의 개념입니다.

모든 문제에 완벽한 '만능' 데이터베이스는 없습니다. 데이터베이스는 크게 **RDBMS**와 **NoSQL**이라는 두 진영으로 나뉘며, 각각 명확한 장단점을 가집니다.

-----

### RDBMS (관계형 데이터베이스 관리 시스템)

  * **대표 주자:** PostgreSQL, MySQL, Oracle
  * **핵심 특징:**
      * **엄격한 스키마:** 정해진 구조(테이블, 컬럼, 타입)에 따라 데이터를 저장합니다.
      * **ACID 트랜잭션:** 데이터의 원자성(Atomicity), 일관성(Consistency), 고립성(Isolation), 지속성(Durability)을 보장하여 데이터 무결성을 최우선으로 합니다.
      * **SQL:** 강력하고 표준화된 질의 언어(SQL)를 통해 복잡한 `JOIN`이나 집계가 가능합니다.
  * **최적의 사용 사례:** 데이터의 **무결성과 일관성**이 비즈니스의 성공에 절대적으로 중요한 경우. (예: 금융 거래, 주문 처리, 예약 시스템)

### NoSQL (Not Only SQL)

NoSQL은 RDBMS의 한계를 극복하기 위해 등장한 다양한 비관계형 데이터베이스를 총칭합니다. 목적에 따라 여러 종류로 나뉩니다.

  * **도큐먼트 데이터베이스 (Document Database):**

      * **대표 주자:** MongoDB, Couchbase
      * **핵심 특징:** 유연한 JSON과 유사한 도큐먼트(Document) 구조로 데이터를 저장합니다. 스키마가 고정되어 있지 않아 변화에 유연합니다.
      * **최적의 사용 사례:** 상품 카탈로그, 콘텐츠 관리, 사용자 프로필처럼 데이터 구조가 비정형적이거나 자주 변경될 때 유리합니다.

  * **키-값 저장소 (Key-Value Store):**

      * **대표 주자:** Redis, Amazon DynamoDB
      * **핵심 특징:** `Key` 하나에 `Value` 하나를 저장하는 가장 단순한 모델입니다. `Key`를 통한 조회 속도가 극도로 빠릅니다.
      * **최적의 사용 사례:** 캐싱, 사용자 세션 관리, 실시간 순위표 등 빠른 응답 속도가 중요한 데이터에 적합합니다.

  * **검색 엔진 (Search Engine):**

      * **대표 주자:** Elasticsearch, OpenSearch
      * **핵심 특징:** 역인덱스(Inverted Index) 구조를 사용하여 전문(Full-text) 검색, 복잡한 조건 필터링, 집계 및 분석에 특화되어 있습니다.
      * **최적의 사용 사례:** 상품 검색, 로그 분석 등 RDBMS의 `LIKE` 검색으로는 불가능한 수준의 강력한 검색 기능이 필요할 때 사용합니다.

-----

### 우리 이커머스 도메인을 위한 DB 선택 가이드 🗺️

이제 우리의 5개 마이크로서비스에 가장 적합한 데이터베이스를 선택해 봅시다.

| 서비스 | 핵심 요구사항 | 추천 DB 기술 | 선택 이유 |
| :--- | :--- | :--- | :--- |
| **`order-service`** | **트랜잭션, 데이터 정합성** | **RDBMS (PostgreSQL)** | 주문, 주문 항목, 결제 금액 등은 단 하나의 오류도 용납할 수 없는 금융 데이터입니다. **ACID 트랜잭션** 보장은 선택이 아닌 필수입니다. |
| **`payment-service`** | **트랜잭션, 데이터 무결성** | **RDBMS (PostgreSQL)** | `order-service`와 동일한 이유입니다. PG사와의 연동 기록, 환불 상태 등을 정확하게 추적해야 하므로 RDBMS가 가장 적합합니다. |
| **`member-service`** | **구조화된 데이터, 일관성** | **RDBMS (MySQL)** 또는 **Document DB** | 회원 정보는 비교적 구조화되어 있어 RDBMS로 충분합니다. 하지만 향후 사용자의 취향, 활동 로그 등 다양한 비정형 데이터를 프로필에 추가할 계획이라면 Document DB도 좋은 대안이 될 수 있습니다. |
| **`shipping-service`** | **구조화된 워크플로우** | **RDBMS (MySQL)** | 배송 요청, 송장 번호 발급, 배송 상태 변경 등은 명확한 상태 전이를 가지는 구조화된 데이터이므로 RDBMS로 안정적으로 관리할 수 있습니다. |
| **`product-service`** | **빠른 검색(읽기) + 정확한 재고(쓰기)** | **Hybrid: Elasticsearch(읽기) + RDBMS(쓰기)** | 이 서비스는 09장 CQRS 패턴의 완벽한 예시입니다. <br> • **쓰기(Command):** `재고 차감`은 강력한 트랜잭션이 필요하므로 **RDBMS**가 관리합니다.<br> • **읽기(Query):** 카테고리, 가격대, 브랜드별 필터링과 텍스트 검색 기능은 **Elasticsearch**가 RDBMS보다 수십 배 빠르고 강력한 성능을 제공합니다. |

이처럼 `Database per Service` 패턴은 우리에게 각 서비스의 목적에 맞는 최적의 무기(DB)를 선택할 수 있는 자유를 줍니다. 다음 절에서는 이처럼 분리된 데이터베이스 환경에서 어떻게 데이터의 일관성을 유지하는지, '최종 일관성'의 개념에 대해 알아보겠습니다.