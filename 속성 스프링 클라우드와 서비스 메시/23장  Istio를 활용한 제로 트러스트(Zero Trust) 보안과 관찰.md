# 23장: Istio를 활용한 제로 트러스트(Zero Trust) 보안과 관찰

## 00. 왜 mTLS(상호 TLS)가 MSA 보안의 핵심인가?

지금까지 우리는 서비스의 '기능'과 '안정성'에 집중했습니다. 하지만 프로덕션 환경에서는 '보안'이 그 무엇보다 중요합니다. 쿠버네티스의 기본 네트워크 모델은 매우 단순하고 개방적입니다. 기본적으로, **클러스터 내의 모든 Pod는 다른 모든 Pod와 자유롭게 통신할 수 있다**는 '신뢰 기반(Trusted)' 모델입니다.

이 '내부자는 모두 믿는다'는 모델은 현대 MSA 환경에서 매우 위험한 보안 허점을 만듭니다.

---

### 신뢰 기반 네트워크의 위험성

`order-service`가 `product-service`를 호출하는 트래픽은 클러스터 내부 네트워크를 통해 일반적인 **암호화되지 않은 HTTP**로 전달됩니다. 만약 공격자가 상대적으로 덜 중요한 `logging-sidecar` 같은 컨테이너 하나의 취약점을 통해 클러스터 내부에 침투했다면 어떤 일이 벌어질까요?

1.  **도청 (Eavesdropping):** 공격자는 `tcpdump`와 같은 네트워크 스니핑 도구를 사용하여, 클러스터 내부를 오가는 모든 암호화되지 않은 트래픽을 엿볼 수 있습니다. 고객의 개인정보, 서비스 간에 사용되는 내부 API 키 등이 그대로 노출될 수 있습니다.

2.  **신원 위장 (Spoofing / Impersonation):** 공격자의 컨테이너가 스스로를 `order-service`라고 속이고 `payment-service`에 "주문 123번을 공격자의 계좌로 환불해달라"는 가짜 요청을 보낼 수 있습니다. `payment-service`는 이 요청이 정말로 '진짜' `order-service`로부터 온 것인지 검증할 방법이 없습니다.

이러한 위험 때문에, 현대 보안 아키텍처는 **제로 트러스트(Zero Trust, 절대 신뢰하지 않음)** 모델로 전환하고 있습니다. 제로 트러스트의 핵심 철학은 간단합니다.

> **"내부 네트워크든 외부 네트워크든 아무도 믿지 마라. 모든 통신은 반드시 암호화하고, 통신하는 양쪽 모두의 신원을 항상 검증하라."**

---

### 해답: mTLS (상호 TLS, Mutual TLS)

이 제로 트러스트 원칙을 네트워크 레벨에서 구현하는 핵심 기술이 바로 **mTLS (상호 TLS)**입니다.

* **일반적인 TLS (HTTPS 통신):** 우리가 브라우저로 은행 사이트에 접속할 때, 우리 **브라우저(클라이언트)**는 은행 **서버**의 신원(TLS 인증서)만 확인합니다. 이는 **'단방향' 인증**입니다. 서버는 우리 브라우저의 신원을 암호학적으로 검증하지 않습니다. (로그인 ID/PW로 인증)

* **상호 TLS (mTLS):** 이는 **'양방향' 인증**입니다.
    1. 클라이언트가 서버의 인증서를 검증합니다.
    2. **그리고 서버 또한 클라이언트의 인증서를 검증합니다.**



mTLS 핸드셰이크가 성공적으로 완료되면, 통신하는 양쪽은 **서로가 누구인지 암호학적으로 완벽하게 증명**한 것이며, 둘 사이의 모든 통신 채널은 **암호화**됩니다. 이를 통해 '도청'과 '신원 위장' 문제를 동시에 해결할 수 있습니다.

#### mTLS 직접 구현의 고통

하지만 mTLS를 직접 구현하는 것은 엄청나게 복잡한 작업입니다. 모든 마이크로서비스 개발팀은 인증서 발급, 개인 키 관리, 인증서 주기적 갱신(Rotation), HTTP 클라이언트/서버의 mTLS 설정 등, 비즈니스 로직과 무관한 복잡한 인프라 작업을 직접 처리해야 합니다. 이는 거의 불가능에 가깝습니다.

---

### Istio: 투명한 자동 mTLS (Automatic mTLS)

바로 이 지점에서 Istio와 같은 서비스 메시가 진정한 힘을 발휘합니다. Istio는 **애플리케이션 코드를 단 한 줄도 변경하지 않고**, 단 몇 줄의 YAML 설정만으로 서비스 메시 **전체에 mTLS를 투명하게 강제**할 수 있습니다.

**동작 방식 (21장 복습):**
1.  **Istiod(Citadel):** 서비스 메시 전체의 **인증 기관(CA)** 역할을 수행하며, 모든 워크로드의 인증서를 발급하고 관리합니다.
2.  **Envoy 사이드카:** Pod가 시작될 때, 자신의 신원(쿠버네티스 `ServiceAccount`)을 기반으로 Istiod로부터 고유한 TLS 인증서를 자동으로 발급받습니다.
3.  **mTLS 핸드셰이크:** `order-service`의 Envoy 프록시가 `product-service`의 Envoy 프록시를 호출할 때, 두 프록시는 Istiod로부터 발급받은 인증서를 사용하여 **자동으로 mTLS 핸드셰이크**를 수행합니다.
4.  **투명한 암호화/복호화:** 두 프록시 사이를 흐르는 트래픽은 mTLS로 암호화되고, 프록시가 실제 애플리케이션 컨테이너(`localhost` 통신)로 트래픽을 전달하기 직전에 복호화됩니다.

`order-service` 애플리케이션은 자신이 암호화 통신을 하고 있다는 사실조차 전혀 인지하지 못합니다.

결론적으로, mTLS는 분산된 MSA 환경의 내부 통신을 보호하는 가장 핵심적인 보안 기술입니다. Istio는 이 복잡한 mTLS 구현을 플랫폼 레벨의 '기본 기능'으로 단순화하여, 개발자가 보안에 대한 걱정 없이 비즈니스 로직에만 집중할 수 있는 안전한 제로 트러스트 네트워크 환경을 제공합니다.