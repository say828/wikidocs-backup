## Istio 아키텍처 심층 분석: Istiod의 역할과 컴포넌트

21장 02절에서 우리는 데이터 플레인의 '일꾼'인 Envoy 사이드카 프록시를 배웠습니다. 이제 이 수많은 일꾼들을 지휘하는 '두뇌', 즉 Istio의 **컨트롤 플레인(Control Plane)**을 심층 분석해 보겠습니다.

과거 Istio 1.5 이전 버전에서는, 컨트롤 플레인이 `Pilot`(트래픽 관리), `Galley`(설정), `Citadel`(보안), `Mixer`(정책/원격 측정) 등 여러 개의 복잡한 컴포넌트로 나뉘어 있었습니다. 하지만 현대의 Istio 아키텍처는 이 모든 핵심 기능을 **Istiod**라는 **단일 모놀리스 컴포넌트**로 통합하여 설치와 운영을 극적으로 단순화했습니다.

**Istiod**는 서비스 메시 전체를 통치하는 **'중앙 관제 센터'** 🚀 역할을 수행합니다.



---

### Istiod의 핵심 기능 (과거 컴포넌트의 역할)

Istiod는 내부적으로 다음과 같은 핵심 책임들을 수행합니다.

#### 1. 트래픽 관리 및 서비스 디스커버리 (구 Pilot ✈️)

이것이 Istiod의 가장 핵심적인 역할입니다.
* **서비스 디스커버리:** Istiod는 쿠버네티스 API 서버를 지속적으로 감시하여, 클러스터 내의 모든 `Service`와 그에 속한 `Pod`들의 IP 주소 목록을 실시간으로 파악합니다.
* **라우팅 규칙 수신:** 개발자나 운영자는 `VirtualService`, `DestinationRule` (22장에서 자세히 다룸)과 같은 Istio 전용 YAML 파일을 클러스터에 적용하여, "`/api/v1` 경로는 `v1` Pod로, `/api/v2` 경로는 `v2` Pod로 보내라" 와 같은 상위 레벨의 라우팅 규칙을 정의합니다.
* **Envoy 설정 변환 및 전파:** Istiod는 '쿠버네티스의 서비스 목록'과 '운영자가 정의한 라우팅 규칙'을 모두 조합한 뒤, 이를 Envoy 프록시가 이해할 수 있는 **저수준의 설정으로 변환**합니다. 그리고 이 최종 설정을 **xDS API**라는 표준 프로토콜을 통해 클러스터 내의 모든 Envoy 사이드카에 **실시간으로 푸시(Push)**합니다.

즉, Istiod는 **'사람의 의도(상위 레벨 YAML)'를 '프록시의 실제 동작(저수준 설정)'으로 번역하고 전파하는** 핵심 번역가이자 전파자입니다.

#### 2. 보안 및 인증서 관리 (구 Citadel 🏰)

Istiod는 서비스 메시 내의 모든 워크로드를 위한 **인증 기관(Certificate Authority, CA)** 역할을 수행하여, 강력한 **상호 TLS(mTLS)** 암호화를 코드 변경 없이 자동으로 활성화합니다.
1.  새로운 Pod가 사이드카와 함께 시작되면, Envoy 프록시는 자신의 개인 키를 생성하고, 자신의 신원(쿠버네티스 `ServiceAccount`)을 증명하는 **인증서 서명 요청(CSR)**을 Istiod로 보냅니다.
2.  Istiod는 이 요청을 받아 신원을 확인한 뒤, 자신의 루트 인증서로 서명한 **단기(Short-lived) TLS 인증서**를 발급하여 Envoy 프록시에게 돌려줍니다.
3.  이제 클러스터 내의 모든 Envoy 프록시는 Istiod가 발급한 신뢰할 수 있는 인증서를 갖게 됩니다. 이를 통해, 프록시들은 서로 통신할 때 상대방의 신원을 암호학적으로 검증하고 모든 트래픽을 자동으로 암호화할 수 있습니다.

이 과정을 통해 개발자는 TLS/SSL에 대한 복잡한 설정 없이도, 모든 서비스 간 통신이 자동으로 암호화되는 **제로 트러스트(Zero Trust)** 네트워크를 손쉽게 구축할 수 있습니다.

#### 3. 설정 검증 (구 Galley)

운영자가 클러스터에 적용하는 모든 Istio 관련 YAML 파일(VirtualService 등)의 문법이 올바른지, 서로 충돌하는 내용은 없는지 **유효성을 검사**하고 수신하는 역할을 합니다. 현재는 Istiod의 내부 기능으로 통합되었습니다.

---

**결론적으로, Istiod는 Istio 서비스 메시의 명실상부한 '두뇌'이자 '심장'입니다.**

데이터 플레인의 Envoy 프록시들이 분산된 '힘'을 제공한다면, 컨트롤 플레인의 Istiod는 이 힘을 한 곳에서 지능적으로 '제어'합니다. 운영자는 Istiod라는 단일 창구를 통해 전체 마이크로서비스들의 통신 방식을 선언적으로 관리할 수 있게 됩니다.

다음 절에서는 이 Istio를 우리 쿠버네티스 클러스터에 실제로 설치하고, 사이드카를 우리 서비스에 자동으로 주입하는 방법을 알아보겠습니다.