## 01. [비교 분석] Calico vs. Cilium vs. Flannel: 우리 플랫폼에 맞는 CNI 선택 가이드

CNI라는 표준 인터페이스 덕분에 우리는 다양한 네트워킹 솔루션 중에서 선택할 수 있는 축복과 동시에 고민을 안게 되었다. 어떤 CNI를 선택하느냐는 클러스터의 성능, 확장성, 그리고 보안 수준을 결정하는 가장 근본적인 아키텍처 결정 중 하나다. 이 선택은 한번 내려지면 바꾸기가 매우 어렵기 때문에, 각 CNI의 철학과 기술적 트레이드오프를 명확히 이해하는 것은 플랫폼 엔지니어의 핵심 역량이다.

여기서는 오늘날 CNCF 생태계에서 가장 널리 사용되고 논의되는 세 가지 CNI, 즉 **Flannel, Calico, Cilium**을 집중적으로 비교 분석하여 당신의 선택을 돕고자 한다.

---

### Flannel: 단순함의 미학

Flannel은 CoreOS에서 개발한, 가장 단순하고 직관적인 CNI 중 하나다. Flannel의 핵심 목표는 단 하나, **"어떻게든 파드들이 서로 통신하게 만든다"**는 것이다. 이를 위해 Flannel은 **VXLAN(Virtual Extensible LAN)**이라는 **오버레이 네트워크(Overlay Network)** 기술을 사용한다.

오버레이 네트워크란, 기존의 물리적 네트워크(Underlay) 위에 가상의 터널을 만들어, 각 노드를 하나의 거대한 가상 L2 스위치에 연결된 것처럼 보이게 만드는 기술이다. `node-1`의 파드가 `node-2`의 파드에게 패킷을 보내면, `node-1`의 `flanneld` 데몬이 이 패킷을 가로채 VXLAN 헤더로 감싼다(Encapsulation). 그리고 이 캡슐화된 패킷을 `node-2`의 IP 주소로 보낸다. `node-2`의 `flanneld`는 이 패킷을 받아 캡슐을 벗겨내고(Decapsulation) 원래의 목적지 파드에게 전달한다.

* **장점:** 설정이 매우 간단하고 직관적이다. 기존 네트워크 인프라에 대한 변경이 거의 필요 없어, 어떤 환경에서든 쉽게 시작할 수 있다. 학습 곡선이 낮아 개발 환경이나 소규모 클러스터에 적합하다.
* **단점:** VXLAN 캡슐화/역캡슐화 과정에서 약간의 성능 오버헤드가 발생한다. 더 결정적으로, Flannel은 쿠버네티스의 **네트워크 정책(Network Policy)**을 지원하지 않는다. 즉, 파드 간의 접근 제어를 구현할 수 없어 보안 요구사항이 높은 프로덕션 환경에는 부적합하다.

**선택 가이드:** 네트워크 정책이 필요 없고, 가장 빠르게 쿠버네티스 클러스터를 시작하고 싶을 때, 혹은 개발/테스트 환경을 위한 선택지다.

---

### Calico: 보안과 확장성의 강자

Calico는 네트워크 정책과 대규모 확장성에 초점을 맞춘 CNI다. Calico의 가장 큰 특징은 오버레이 네트워크를 사용하지 않고, 순수한 **L3 라우팅**을 통해 파드 간 통신을 구현한다는 점이다. 각 노드는 **BGP(Border Gateway Protocol)**를 사용하는 라우터 역할을 수행하며, 자신의 노드에서 실행 중인 파드들의 IP 대역(/26 CIDR 블록)을 다른 노드들에게 "이쪽으로 오려면 나에게 보내"라고 광고한다.

이 방식은 패킷을 캡슐화할 필요가 없어 Flannel에 비해 더 나은 네이티브 성능을 제공한다. 하지만 Calico의 진정한 힘은 강력하고 세분화된 **네트워크 정책** 기능에 있다. Calico는 쿠버네티스의 기본 NetworkPolicy를 넘어, 글로벌 정책, 정책 순서 지정, `deny` 규칙 등 훨씬 더 풍부한 보안 기능을 제공하여 제로 트러스트 네트워크를 구현하는 데 매우 강력한 도구가 된다.

* **장점:** 뛰어난 네트워크 정책 기능. 오버레이가 없어 네이티브에 가까운 성능. BGP를 통해 대규모 클러스터(수천 노드)까지 확장이 검증되었다.
* **단점:** BGP 설정은 VXLAN보다 복잡할 수 있으며, 일부 클라우드나 온프레미스 환경에서는 네트워크 팀과의 협력이 필요할 수 있다. (물론, Calico도 IPIP나 VXLAN 오버레이 모드를 지원하여 호환성을 높일 수 있다.)

**선택 가이드:** 강력한 네트워크 격리와 보안이 최우선 순위일 때, 대규모 프로덕션 클러스터를 운영해야 할 때 가장 표준적인 선택이다.

---

### Cilium: eBPF 기반의 차세대 혁신

Cilium은 이 세 가지 CNI 중 가장 현대적이고 혁신적인 접근법을 취한다. Cilium의 심장에는 **eBPF(extended Berkeley Packet Filter)**라는 리눅스 커널의 혁명적인 기술이 있다. eBPF는 커널 소스 코드를 직접 수정하지 않고도, 커널의 동작(네트워킹, 보안, 추적 등)을 안전하고 효율적으로 프로그래밍할 수 있게 해주는 마법과도 같은 기술이다.

Cilium은 eBPF를 활용하여 기존의 iptables나 IPVS를 우회하고, 커널의 네트워킹 스택 초기 단계에서 직접 패킷을 처리한다. 이는 다음과 같은 경이로운 이점을 가져온다.

* **압도적인 성능:** 복잡한 iptables 체인을 거치지 않으므로, 특히 서비스(ClusterIP) 로드 밸런싱과 네트워크 정책 적용에서 다른 CNI들을 압도하는 성능을 보여준다.
* **강화된 보안과 가시성:** eBPF는 L3/L4 정보(IP, Port)를 넘어, L7 수준(HTTP 요청 경로, gRPC 메서드 등)에서 패킷을 이해할 수 있다. 이를 통해 "A 서비스는 B 서비스의 `/api/v1/read` 엔드포인트에만 `GET` 요청을 보낼 수 있다"와 같은 API 수준의 네트워크 정책을 적용할 수 있다. 또한, Hubble이라는 내장 도구를 통해 서비스 간의 모든 통신 흐름을 실시간으로 시각화하여 놀라운 수준의 가시성을 제공한다.
* **서비스 메시 기능 내장:** 최신 버전의 Cilium은 사이드카 프록시 없이 eBPF만으로 서비스 메시의 일부 기능(L7 라우팅, 로드 밸런싱 등)을 구현하여, Istio와 같은 전통적인 서비스 메시의 성능 오버헤드를 줄이는 대안을 제시한다.

* **장점:** 최고의 성능과 확장성. API-aware 네트워크 정책. 뛰어난 관측 가능성(Hubble). 서비스 메시 기능 내장.
* **단점:** eBPF를 지원하는 비교적 최신 리눅스 커널 버전(4.9 이상 권장)이 필요하다. 기술 자체가 최첨단이므로 다른 CNI에 비해 아직 커뮤니티의 성숙도나 운영 노하우가 상대적으로 덜 축적되었을 수 있다.

**선택 가이드:** 최고의 성능, 강력한 API 수준 보안, 그리고 뛰어난 가시성을 원하며 최신 기술 스택을 도입하는 데 거리낌이 없는 조직을 위한 미래 지향적인 선택이다.

---

**[도표: CNI 플러그인별 성능 및 기능 비교 (Calico vs. Cilium vs. Flannel)]**

| 기능 | Flannel | Calico | Cilium |
| :--- | :--- | :--- | :--- |
| **핵심 기술** | VXLAN (Overlay) | BGP (L3 Routing) | eBPF |
| **성능** | 낮음 (오버헤드 존재) | 높음 | 매우 높음 |
| **네트워크 정책** | ❌ 지원 안함 | ✅ 매우 강력함 | ✅ API-Aware (L7) |
| **확장성** | 중간 | 높음 (대규모 검증) | 매우 높음 |
| **관측 가능성** | 기본 | 기본 | 뛰어남 (Hubble) |
| **설정 복잡도**| 매우 낮음 | 중간 | 중간 |
| **추천 사용 사례**| 개발/테스트, 소규모 | 보안 중심, 대규모 프로덕션 | 성능/보안/가시성 모두 중요 |

이제 우리는 파드에 IP를 할당하는 방법을 알았다. 그렇다면 서비스(Service)는 어떻게 `my-service`라는 이름만으로 올바른 파드의 IP를 찾아갈 수 있을까? 다음 절에서는 이 서비스 디스커버리의 마법을 가능하게 하는 쿠버네티스 DNS의 세계를 탐험해 볼 것이다.