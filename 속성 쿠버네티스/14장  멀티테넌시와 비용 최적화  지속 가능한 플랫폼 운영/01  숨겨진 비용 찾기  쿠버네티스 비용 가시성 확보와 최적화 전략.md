## 01. 숨겨진 비용 찾기: 쿠버네티스 비용 가시성 확보와 최적화 전략

우리는 이제 각 팀에게 vCluster라는 독립적인 작업 공간을 제공했다. 하지만 이 모든 워크로드는 결국 동일한 물리적 노드(EC2 인스턴스, GCP Compute Engine 등) 위에서 실행되며, 이는 매달 당신의 회사에 거대한 클라우드 비용 청구서를 안겨준다. 이 청구서를 받아든 재무팀이 "이번 달에 `product-dev` 팀이 사용한 인프라 비용은 정확히 얼마죠?"라고 물었을 때, 당신은 어떻게 대답할 것인가? 💸

전통적인 인프라에서는 이 질문에 답하기 쉬웠다. `product-dev` 팀은 자신들만의 VM들을 사용했으므로, 그 VM들의 비용을 합산하면 그만이었다. 하지만 쿠버네티스의 세계에서는 이 경계가 완전히 무너진다. 수십 개의 팀이 사용하는 수백 개의 파드들이 동일한 10개의 거대한 노드 위에서 뒤섞여 실행되는 **'공유 경제'** 모델이기 때문이다. 노드(EC2 인스턴스) 단위로만 비용을 볼 수 있는 클라우드 청구서는, 이 노드 안에서 어떤 파드가 얼마나 많은 자원을 점유했는지에 대한 미세한 정보를 전혀 알려주지 못한다.

이것이 바로 쿠버네티스 비용 관리의 첫 번째이자 가장 큰 난관, **가시성(Visibility)**의 부재다. 비용을 최적화하려면, 먼저 비용이 어디서 발생하는지를 알아야 한다. 안개 속에 가려진 비용의 실체를 파헤치고, 각 워크로드, 팀, 애플리케이션 단위로 비용을 정확하게 배분하는 기술이 필요하다.

이 가시성을 확보하기 위한 가장 기본적인 전략은 일관된 **레이블링(Labeling)** 정책을 수립하는 것이다. 모든 디플로이먼트, 스테이트풀셋, 파드에 `team: product-dev`, `app: user-service`, `env: production`과 같은 식별 가능한 레이블을 붙이는 것이다. 하지만 레이블만으로는 부족하다. 우리는 이 레이블과 파드의 실제 자원 사용량(CPU, 메모리, 스토리지)을 결합하여, 이를 달러($)로 환산해 줄 전문적인 도구가 필요하다.

이 영역의 대표적인 오픈소스 솔루션이 바로 CNCF 샌드박스 프로젝트인 **OpenCost** (그리고 그 상용 버전인 Kubecost)다.

OpenCost는 다음과 같이 작동한다.
1.  클라우드 제공업체의 청구 API와 연동하여, 각 노드(EC2 인스턴스)의 시간당 비용 정보를 가져온다.
2.  쿠버네티스 메트릭 서버로부터 각 파드의 자원 `requests`와 실제 `usage` 데이터를 수집한다.
3.  이 두 가지 데이터를 결합하여, "이 노드의 시간당 비용은 $0.20이고, `user-service-pod-1`이 이 노드 CPU의 10%를 요청했으므로, 이 파드의 시간당 CPU 비용은 $0.02다"와 같은 정교한 비용 배분(Cost Allocation) 계산을 수행한다.



OpenCost와 같은 도구를 통해 우리는 비로소 다음과 같은 질문에 답할 수 있게 된다.
* "우리 회사에서 가장 많은 비용을 사용하는 네임스페이스는 어디인가?"
* "`recommendation-service`는 비즈니스 가치에 비해 과도한 인프라 비용을 쓰고 있지는 않은가?"
* "개발 환경이 전체 클러스터 비용의 40%를 차지하는 것이 합당한가?"

이러한 **비용 가시성**을 확보하는 것만으로도, 우리는 이미 비용 최적화의 절반을 달성한 것이나 다름없다. 데이터에 기반한 대화는 각 팀이 자신의 워크로드가 발생시키는 비용에 대해 **주인의식(Ownership)**을 갖게 만드는 가장 강력한 동기가 된다.

이제 우리는 어디서 돈이 새고 있는지 볼 수 있는 눈을 가졌다. 다음으로는 이 낭비를 근절하고, 필요한 만큼만 정확하게 자원을 사용하는 가장 지능적인 방법, 동적 노드 오토스케일링의 세계로 들어가 볼 것이다.