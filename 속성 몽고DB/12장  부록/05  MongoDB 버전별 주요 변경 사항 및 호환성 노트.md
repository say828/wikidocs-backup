## MongoDB 버전별 주요 변경 사항 및 호환성 노트

이 부록은 MongoDB의 주요 릴리스 버전별로 도입된 핵심적인 기능, 변경 사항, 그리고 업그레이드 시 고려해야 할 호환성 이슈를 요약하여 제공합니다. 이를 통해 플랫폼의 발전 과정을 이해하고, 마이그레이션 계획을 수립하는 데 도움을 얻을 수 있습니다.

**주의:** 이 목록은 모든 변경 사항을 담고 있지 않으며, 실제 업그레이드를 진행하기 전에는 반드시 공식 릴리스 노트를 정독해야 합니다.

---

### MongoDB 7.0 (2023년 출시)
* **주요 특징:**
    * **Queryable Encryption 정식 지원:** 클라이언트 측 필드 레벨 암호화의 확장판으로, 서버가 암호화된 데이터를 복호화하지 않고도 평문처럼 동등(equality) 쿼리를 처리할 수 있게 하는 혁신적인 보안 기능이 정식으로 지원됩니다.
    * **Compound Wildcard Indexes:** 여러 필드 및 서브 도큐먼트에 걸쳐 동적으로 인덱스를 생성할 수 있는 복합 와일드카드 인덱스가 도입되어, 예측 불가능한 스키마 구조에 대한 쿼리 성능이 향상되었습니다.
    * **`$median` 애그리게이션 연산자:** 중앙값을 계산할 수 있는 새로운 애그리게이션 연산자가 추가되었습니다.
* **호환성 및 업그레이드 노트:**
    * 업그레이드를 위해서는 이전 버전의 FCV(Feature Compatibility Version)가 `6.0`이어야 합니다.
    * 특정 CPU 마이크로아키텍처(x86_64 환경에서 AVX 지원 등)에 대한 요구사항이 강화되었습니다.

---

### MongoDB 6.0 (2022년 출시)
* **주요 특징:**
    * **Change Streams 기능 대폭 강화:** 변경 이벤트에 데이터 변경 전(`fullDocumentBeforeChange`)과 후의 전체 도큐먼트를 포함할 수 있게 되어, 이벤트 기반 아키텍처 구현이 더욱 용이해졌습니다.
    * **향상된 애그리게이션:** `$lookup`에 상관 서브쿼리(correlated subquery)와 유사한 기능이 추가되고, `$denseRank`, `$sortArray` 등 강력한 새 연산자들이 도입되었습니다.
    * **Queryable Encryption (Preview):** Queryable Encryption 기능이 프리뷰로 처음 소개되었습니다.
* **호환성 및 업그레이드 노트:**
    * 5.0에서 도입된 시계열(Time Series) 컬렉션의 성능 및 기능이 대폭 개선되었습니다.
    * 업그레이드를 위해서는 FCV가 `5.0`이어야 합니다.

---

### MongoDB 5.0 (2021년 출시)
* **주요 특징:**
    * **시계열 컬렉션 (Time Series Collections):** IoT, 금융, 로그 데이터 등 시계열 데이터의 수집, 저장, 쿼리에 고도로 최적화된 새로운 컬렉션 유형이 도입되었습니다. (이 책의 10장 참조)
    * **라이브 리샤딩 (Live Resharding):** 운영 중인 샤드 클러스터의 샤드 키를 서비스 중단 없이 변경할 수 있는 획기적인 기능이 도입되었습니다.
    * **`mongosh` 도입:** 기존의 레거시 `mongo` 셸을 대체하는, 더욱 강력하고 현대적인 새로운 MongoDB Shell(`mongosh`)이 기본 셸이 되었습니다.
    * **버전 릴리스 정책 변경:** 매년 새로운 메이저 버전을 출시하는 정책이 시작되었습니다.
* **호환성 및 업그레이드 노트:**
    * 샤딩 메타데이터와 관련된 내부 아키텍처에 큰 변화가 있었습니다.
    * 업그레이드를 위해서는 FCV가 `4.4`여야 합니다.

---

### MongoDB 4.4 (2020년 출시)
* **주요 특징:**
    * **`$unionWith` 애그리게이션 스테이지:** 하나의 애그리게이션 파이프라인 내에서 여러 컬렉션의 데이터를 통합하여 분석할 수 있게 되었습니다.
    * **Hedged Reads:** 샤드 클러스터에서 읽기 지연 시간을 줄이기 위해, 동일한 읽기 요청을 두 개의 레플리카 셋 멤버에게 보내고 더 빠른 응답을 사용하는 옵션이 추가되었습니다.
    * **Refinable Shard Keys:** 기존 샤드 키에 새로운 필드를 접미사(suffix)로 추가하여, 완전한 리샤딩 없이도 데이터 분산도를 개선할 수 있게 되었습니다.
* **호환성 및 업그레이드 노트:**
    * 이 버전은 레거시 `mongo` 셸을 지원하는 마지막 주요 릴리스 중 하나입니다.

---

### MongoDB 4.2 (2019년 출시)
* **주요 특징:**
    * **분산 트랜잭션 (Distributed Transactions):** 4.0에서 레플리카 셋에 한해 도입되었던 멀티-도큐먼트 ACID 트랜잭션이 **샤드 클러스터** 전반으로 확장 지원되었습니다. 이는 MongoDB 역사상 가장 중요한 기능 중 하나입니다. (이 책의 5장 참조)
    * **와일드카드 인덱스 (Wildcard Indexes):** 스키마가 유동적이거나 예측 불가능한 필드들에 대해 포괄적인 인덱싱을 지원하는 기능이 처음 도입되었습니다.
    * **필드 레벨 암호화 (Field Level Encryption, FLE):** 클라이언트 사이드에서 특정 필드의 값을 애플리케이션이 직접 암호화하여 데이터베이스에 저장하는 기능이 도입되었습니다.
    * **`zstd` 압축 지원:** 뛰어난 성능과 압축률의 균형을 자랑하는 zstd 압축 알고리즘이 지원되기 시작했습니다. (이 책의 8장 참조)
* **호환성 및 업그레이드 노트:**
    * 인덱스 빌드가 기본적으로 백그라운드(background) 방식으로 동작하도록 변경되어, 운영 편의성이 크게 향상되었습니다.

MongoDB는 이처럼 매년 빠르게 발전하고 있는 데이터 플랫폼입니다. 성공적인 운영을 위해서는 새로운 기능에 대한 지속적인 학습과 함께, 업그레이드 전 릴리스 노트를 꼼꼼히 확인하는 습관이 매우 중요합니다.