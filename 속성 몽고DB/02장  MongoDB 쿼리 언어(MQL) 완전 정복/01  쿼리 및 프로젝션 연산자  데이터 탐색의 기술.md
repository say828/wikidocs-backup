## 01\. 쿼리 및 프로젝션 연산자: 데이터 탐색의 기술

단순히 `{ field: value }` 형태로 일치하는 도큐먼트를 찾는 것을 넘어, MQL의 진정한 힘은 정교하고 복잡한 조건을 표현할 수 있는 풍부한 **쿼리 연산자(Query Operators)** 세트에서 나옵니다. 이 연산자들은 SQL의 `WHERE` 절에서 사용되는 다양한 조건문과 유사한 역할을 합니다. 또한, 원하는 필드만 선택적으로 반환하여 결과의 형태를 제어하는 **프로젝션 연산자(Projection Operators)** 는 SQL의 `SELECT` 절에 해당합니다. 이 둘을 조합하면 데이터를 매우 효율적으로 탐색할 수 있습니다.

-----

### 쿼리 연산자: 원하는 데이터를 정밀하게 찾아내기

쿼리 연산자는 항상 `$` 기호로 시작하며, 조회 조건 문서 내에서 사용됩니다.

#### A. 비교 연산자 (Comparison Operators)

값의 크기를 비교하거나 특정 범위 내의 값을 찾을 때 사용합니다.

  * `$eq`: (Equal) 지정된 값과 일치. `{ field: value }` 와 동일합니다.
  * `$ne`: (Not Equal) 지정된 값과 일치하지 않음.
  * `$gt`: (Greater Than) 지정된 값보다 큼.
  * `$gte`: (Greater Than or Equal to) 지정된 값보다 크거나 같음.
  * `$lt`: (Less Than) 지정된 값보다 작음.
  * `$lte`: (Less Than or Equal to) 지정된 값보다 작거나 같음.
  * `$in`: (In) 배열로 지정된 여러 값 중 하나와 일치.
  * `$nin`: (Not In) 배열로 지정된 여러 값 중 어느 것과도 일치하지 않음.

**예시: 가격이 $20 이상 $50 미만이고, 카테고리가 "apparel" 또는 "dev-goods"인 상품 조회**

```javascript
db.products.find({
    price: { $gte: 20, $lt: 50 },
    category: { $in: ["apparel", "dev-goods"] }
})
```

-----

#### B. 논리 연산자 (Logical Operators)

여러 개의 조건을 논리적으로 결합할 때 사용합니다.

  * `$and`: 배열 안의 모든 조건이 참이어야 함. (일반적으로 쉼표로 조건을 나열하면 암묵적으로 AND 연산이 됩니다.)
  * `$or`: 배열 안의 조건 중 하나라도 참이면 됨.
  * `$nor`: 배열 안의 모든 조건이 거짓이어야 함.
  * `$not`: 주어진 연산자의 결과를 반전시킴.

**예시: 가격이 $10 미만이거나, 재고가 없는(0개) 상품 조회**

```javascript
db.products.find({
    $or: [
        { price: { $lt: 10 } },
        { stock: { $eq: 0 } }
    ]
})
```

-----

#### C. 엘리먼트 연산자 (Element Operators)

필드의 존재 여부나 BSON 타입을 기준으로 도큐먼트를 찾을 때 사용합니다.

  * `$exists`: `true`로 설정 시 해당 필드가 존재하는 도큐먼트를, `false`로 설정 시 존재하지 않는 도큐먼트를 찾습니다.
  * `$type`: 필드의 값이 지정된 BSON 타입(예: "string", "int", "date")과 일치하는 도큐먼트를 찾습니다.

**예시: 할인(discount) 정보 필드가 아예 없는 상품들만 조회**

```javascript
db.products.find({
    discount: { $exists: false }
})
```

-----

### 프로젝션 연산자: 결과의 형태를 제어하기

프로젝션은 `find()` 메소드의 두 번째 인자로 전달되며, 결과 도큐먼트에 어떤 필드를 포함할지(`1`) 또는 제외할지(`0`) 지정합니다.

  * **포함(Inclusion) 규칙:** 특정 필드들만 보고 싶을 때 사용합니다. `_id`는 기본적으로 항상 포함되므로, 원치 않으면 명시적으로 `{ _id: 0 }`을 추가해야 합니다.
  * **제외(Exclusion) 규칙:** 특정 필드들만 빼고 나머지를 모두 보고 싶을 때 사용합니다.
  * **중요 규칙:** `_id` 필드를 제외하고는, 포함 규칙과 제외 규칙을 하나의 프로젝션 문서에서 섞어 쓸 수 없습니다.

**예시 1: 'apparel' 카테고리 상품의 이름과 가격만 조회 ( `_id`는 제외 )**

```javascript
db.products.find(
    { category: "apparel" }, // Query
    { _id: 0, name: 1, price: 1 } // Projection
)
```

**예시 2: 특정 상품의 모든 정보를 보되, 내부 관리용 필드(`internal_audit_log`)만 제외하고 조회**

```javascript
db.products.findOne(
    { _id: "MDB_MUG_01" }, // Query
    { internal_audit_log: 0 } // Projection
)
```

#### 배열 필드에 대한 프로젝션

  * `$slice`: 배열 필드의 일부 요소만 반환합니다. (예: `{ comments: { $slice: 5 } }` -\> 최근 댓글 5개만)
  * `$elemMatch`: 배열 요소 중 특정 조건을 만족하는 **첫 번째 요소**만 반환합니다.

**예시: 특정 사용자의 정보와 함께, '기본 배송지'로 설정된 주소 하나만 함께 조회**

```javascript
db.users.findOne(
    { username: "atlas_architect" },
    {
        _id: 0,
        username: 1,
        // addresses 배열 중 is_default가 true인 첫 번째 요소만 반환
        addresses: { $elemMatch: { is_default: true } }
    }
)
```

이처럼 쿼리와 프로젝션 연산자를 능숙하게 사용하는 것은, 불필요한 데이터를 애플리케이션으로 전송하지 않고 데이터베이스 단에서 가장 효율적으로 처리하는 핵심 기술입니다. 다음 절에서는 MongoDB의 강점인 배열과 서브 도큐먼트를 쿼리하는 구체적인 기법들을 더 깊이 알아보겠습니다.