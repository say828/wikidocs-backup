## 03. 보안 아키텍처: 인증, 권한 부여, 네트워크 암호화, 저장 데이터 암호화

현대 애플리케이션 환경에서 데이터 보안은 더 이상 선택이 아닌 필수입니다. 단 한 번의 데이터 유출 사고는 기업의 신뢰도를 무너뜨리고, 막대한 법적/재정적 책임으로 이어질 수 있습니다. MongoDB는 **'심층 방어(Defense in Depth)'** 전략에 기반하여, 여러 단계의 독립적인 보안 계층을 제공함으로써 데이터를 안전하게 보호합니다.

만약 하나의 방어선이 뚫리더라도, 다른 방어선이 데이터를 지켜내는 이 다층적 보안 아키텍처는 네 가지 핵심 요소로 구성됩니다.

1.  **인증 (Authentication):** 당신은 누구인가?
2.  **권한 부여 (Authorization):** 당신은 무엇을 할 수 있는가?
3.  **네트워크 암호화 (Encryption in Transit):** 데이터 이동 중 보호
4.  **저장 데이터 암호화 (Encryption at Rest):** 데이터 저장 시 보호

---

### 1. 인증 (Authentication): "Who are you?" 👤

**인증**은 데이터베이스에 접속하려는 클라이언트(사용자, 애플리케이션)가 자신이 누구인지를 증명하는 과정입니다. 이는 데이터베이스로 들어오는 가장 첫 번째 관문입니다. 인증 기능이 활성화되지 않은 데이터베이스는 현관문이 열려있는 집과 같아서, 네트워크 접근만 가능하다면 누구나 모든 데이터에 접근할 수 있습니다.

* **핵심 메커니즘:** MongoDB는 기본적으로 **SCRAM(Salted Challenge Response Authentication Mechanism)** 방식을 사용하여 아이디와 비밀번호를 검증합니다. 이 방식은 실제 비밀번호를 네트워크를 통해 직접 전송하지 않고, 암호학적인 Challenge-Response 과정을 거치기 때문에 중간에 탈취되더라도 안전합니다.
* **고급 메커니즘:** 더 높은 수준의 보안이 필요할 경우, 비밀번호 대신 x.509 인증서를 사용하거나, 기업 환경의 LDAP/Kerberos와 같은 중앙 집중식 인증 시스템과 연동할 수도 있습니다.
* **중요:** **MongoDB Atlas에서는 모든 클러스터에 대해 인증 기능이 기본적으로 활성화 및 강제됩니다.**

---

### 2. 권한 부여 (Authorization): "What can you do?" 🔑

**권한 부여**는 인증된 사용자가 어떤 데이터에 대해 어떤 작업을 수행할 수 있는지를 통제하는 과정입니다. 이는 **'최소 권한의 원칙(Principle of Least Privilege)'**을 구현하는 핵심적인 기능입니다. 즉, 모든 사용자는 자신의 작업을 수행하는 데 필요한 최소한의 권한만을 가져야 합니다.

* **RBAC (Role-Based Access Control, 역할 기반 접근 제어):** MongoDB는 RBAC 모델을 사용합니다.
    * **Privilege (권한):** 특정 리소스에 대한 특정 행동 (예: `ecommerce` 데이터베이스의 `products` 컬렉션에 대한 `find` 행동)
    * **Role (역할):** 권한들의 묶음. MongoDB는 `read`, `readWrite`, `dbAdmin` 등 미리 정의된 역할을 제공하며, 필요에 따라 커스텀 역할을 만들 수 있습니다.
    * **User (사용자):** 사용자에게 하나 이상의 역할을 부여합니다.

**모범 사례:** 각 마이크로서비스나 애플리케이션을 위한 별도의 데이터베이스 사용자를 생성하고, 해당 서비스 기능에 필요한 **정확한 권한만을 가진 커스텀 역할**을 부여해야 합니다. 예를 들어, '상품 조회 서비스'는 `products` 컬렉션에 대한 `find` 권한만 가져야 하며, `insert`나 `update` 권한은 절대로 가져서는 안 됩니다.

---

### 3. 네트워크 암호화 (Encryption in Transit): 데이터 이동 경로 보호 🚚

애플리케이션과 데이터베이스 서버 사이, 또는 레플리카 셋 멤버들 사이에서 데이터가 이동하는 모든 경로를 암호화하여 보호하는 것입니다.

* **위협:** 네트워크 암호화가 없다면, 공격자가 네트워크 트래픽을 도청(sniffing)하여 사용자의 비밀번호나 개인정보와 같은 민감한 데이터를 평문 그대로 탈취할 수 있습니다.
* **해결책: TLS/SSL (Transport Layer Security):** MongoDB는 업계 표준인 TLS/SSL을 사용하여 모든 네트워크 통신을 암호화합니다. 이를 통해 제3자가 데이터를 엿듣는 것(**기밀성**), 중간에 데이터를 변조하는 것(**무결성**), 그리고 클라이언트가 위장된 서버에 접속하는 것(**서버 인증**)을 모두 방지합니다.
* **중요:** **MongoDB Atlas에서는 모든 클라이언트 연결에 대해 TLS/SSL 암호화가 기본적으로 활성화 및 강제됩니다.**

---

### 4. 저장 데이터 암호화 (Encryption at Rest): 잠자는 데이터 보호 😴

데이터베이스 파일이 디스크에 저장되어 있는 상태에서 데이터를 보호하는 것입니다.

* **위협:** 공격자가 서버의 물리적 디스크나 백업 테이프를 탈취했을 경우, 인증/권한 부여 단계를 우회하여 데이터 파일 자체를 직접 읽어 내용을 빼낼 수 있습니다.
* **해결책: TDE (Transparent Data Encryption):** WiredTiger 스토리지 엔진은 저장소 레벨에서 데이터를 자동으로 암호화하는 기능을 지원합니다. 이 기능이 활성화되면, 모든 데이터 파일(컬렉션, 인덱스, 저널)은 디스크에 쓰여지기 전에 암호화되고, 메모리로 읽어올 때 복호화됩니다. 이 과정은 애플리케이션에 완전히 투명하게(transparent) 이루어집니다.
* **키 관리:** 저장 데이터 암호화의 보안 수준은 암호화 키를 얼마나 안전하게 관리하느냐에 달려있습니다. MongoDB는 AWS KMS, Azure Key Vault, Google Cloud KMS와 같은 외부 키 관리 서비스(KMIP)와 연동하여 마스터 키를 안전하게 보관하고 교체하는 기능을 제공합니다.
* **중요:** **MongoDB Atlas에서는 모든 클러스터에 대해 저장 데이터 암호화가 기본적으로 활성화됩니다.**

이 네 가지 보안 계층을 모두 적용함으로써, MongoDB는 민감한 데이터를 다루는 엔터프라이즈급 애플리케이션의 엄격한 보안 요구사항을 충족시키는 견고한 데이터 플랫폼을 구축할 수 있습니다.