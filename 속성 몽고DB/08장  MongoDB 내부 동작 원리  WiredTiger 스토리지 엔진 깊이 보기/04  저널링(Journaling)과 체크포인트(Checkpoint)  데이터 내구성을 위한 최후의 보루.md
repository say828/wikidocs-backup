## 04. μ €λ„λ§(Journaling)κ³Ό μ²΄ν¬ν¬μΈνΈ(Checkpoint): λ°μ΄ν„° λ‚΄κµ¬μ„±μ„ μ„ν• μµν›„μ λ³΄λ£¨

μ„±κ³µμ μΌλ΅ μ‘λ‹µμ„ λ°›μ€ μ“°κΈ° μ‘μ—…μ΄ μ„λ²„μ κ°‘μ‘μ¤λ¬μ΄ μ •μ „μ΄λ‚ OS ν¬λμ‹ μƒν™©μ—μ„λ„ μ λ€ μ μ‹¤λμ§€ μ•λ”λ‹¤λ” λ³΄μ¥, μ¦‰ **λ‚΄κµ¬μ„±(Durability)**μ€ λ¨λ“  λ°μ΄ν„°λ² μ΄μ¤ μ‹μ¤ν…μ κ°€μ¥ κ·Όλ³Έμ μΈ μ•½μ†μ…λ‹λ‹¤. WiredTiger μ¤ν† λ¦¬μ§€ μ—”μ§„μ€ μ΄ μ•½μ†μ„ μ§€ν‚¤κΈ° μ„ν•΄, λΉ„ν–‰κΈ°μ λΉ„ν–‰κΈ°λ΅μ¥μΉμ™€ μ£ΌκΈ°μ μΈ μ•μ „ μ κ²€μ²λΌ μ΄μ¤‘μΌλ΅ κµ¬μ„±λ μ •κµν• λ©”μ»¤λ‹μ¦μ„ μ‚¬μ©ν•©λ‹λ‹¤. λ°”λ΅ **μ €λ„λ§(Journaling)**κ³Ό **μ²΄ν¬ν¬μΈνΈ(Checkpoint)**μ…λ‹λ‹¤.

---

### μ €λ„λ§ (Journaling / WAL): μ¬ν•΄ λ³µκµ¬λ¥Ό μ„ν• λΉ„ν–‰κΈ°λ΅μ¥μΉ βοΈ

**μ €λ„λ§**μ€ λ°μ΄ν„°λ² μ΄μ¤μ— κ°€ν•΄μ§€λ” λ¨λ“  λ³€κ²½ μ‘μ—…μ„, μ‹¤μ  λ°μ΄ν„° νμΌμ— μ μ©ν•κΈ°μ— μ•μ„ λ³„λ„μ **μ €λ„ νμΌ**μ— λ¨Όμ € κΈ°λ΅ν•λ” ν–‰μ„μ…λ‹λ‹¤. μ΄λ” **WAL(Write-Ahead Log, μ„ ν–‰ λ΅κΉ…)** μ΄λΌλ” λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„μ ν‘μ¤€μ μΈ κΈ°λ²•μ…λ‹λ‹¤.

* **λ™μ‘ μ›λ¦¬:**
    1.  ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ“°κΈ° μ”μ²­(`insert`, `update` λ“±)μ΄ λ“¤μ–΄μµλ‹λ‹¤.
    2.  WiredTigerλ” μ΄ λ³€κ²½ μ‘μ—…μ— λ€ν• μƒμ„Έν• λ΅κ·Έ κΈ°λ΅μ„ μƒμ„±ν•©λ‹λ‹¤.
    3.  μ΄ λ΅κ·Έ κΈ°λ΅μ„ λ””μ¤ν¬ μƒμ **μ €λ„ νμΌ**μ— μ¶”κ°€(append)ν•©λ‹λ‹¤. λ””μ¤ν¬μ— μμ°¨μ μΌλ΅ κΈ°λ΅ν•λ” μ΄ μ‘μ—…μ€ λ§¤μ° λΉ λ¦…λ‹λ‹¤.
    4.  **μ €λ„ νμΌμ— κΈ°λ΅μ΄ μ™„λ£λ κ²ƒμ΄ ν™•μΈλ ν›„μ—μ•Ό**, λΉ„λ΅μ† WiredTigerλ” λ©”λ¨λ¦¬ λ‚΄μ **λ‚΄λ¶€ μΊμ‹**μ— μλ” λ°μ΄ν„°λ¥Ό μμ •ν•©λ‹λ‹¤.

**λ‚΄κµ¬μ„± λ³΄μ¥:**
ν΄λΌμ΄μ–ΈνΈκ°€ `writeConcern`μ„ `{ j: true }`λ΅ μ„¤μ •ν•μ—¬ μ“°κΈ°λ¥Ό μ”μ²­ν•λ©΄, MongoDBλ” μ΄ μ €λ„ νμΌ μ“°κΈ°κ°€ μ™„λ£λ  λ•κΉμ§€ κΈ°λ‹¤λ Έλ‹¤κ°€ μ„±κ³µμ„ μ‘λ‹µν•©λ‹λ‹¤. μ¦‰, ν΄λΌμ΄μ–ΈνΈκ°€ 'μ„±κ³µ' μ‘λ‹µμ„ λ°›μ•λ‹¤λ©΄, κ·Έ λ°μ΄ν„°λ” μµμ†ν• μ €λ„ νμΌμ΄λΌλ” μκµ¬μ μΈ μ €μ¥μ†μ— μ•μ „ν•κ² κΈ°λ΅λμ—μμ΄ λ³΄μ¥λ©λ‹λ‹¤.

**μ¬ν•΄ λ³µκµ¬:**
λ§μ•½ `mongod` μ„λ²„κ°€ μκΈ°μΉ μ•κ² λ‹¤μ΄λμ—λ‹¤κ°€ μ¬μ‹μ‘λλ©΄, WiredTigerλ” κ°€μ¥ λ¨Όμ € μ €λ„ νμΌμ„ ν™•μΈν•©λ‹λ‹¤. κ·Έλ¦¬κ³  λ§μ§€λ§‰ μ²΄ν¬ν¬μΈνΈ μ΄ν›„μ— κΈ°λ΅λ μ €λ„ λ΅κ·Έλ“¤μ„ μμ„λ€λ΅ μ½μ–΄, λ©”λ¨λ¦¬ μΊμ‹μ— λ‹¤μ‹ μ μ©(replay)ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄, λ””μ¤ν¬μ μ£Ό λ°μ΄ν„° νμΌμ—λ” μ•„μ§ κΈ°λ΅λμ§€ λ»ν–λ μµκ·Όμ λ¨λ“  λ³€κ²½ μ‚¬ν•­μ„ μ™„λ²½ν•κ² λ³µμ›ν•μ—¬, λ‹¤μ΄ μ§μ „μ μΌκ΄€λ λ°μ΄ν„° μƒνƒλ΅ λλμ•„κ° μ μμµλ‹λ‹¤.

---

### μ²΄ν¬ν¬μΈνΈ (Checkpoint): λ©”λ¨λ¦¬μ™€ λ””μ¤ν¬μ λ™κΈ°ν™” μ‹μ  π’Ύ

**μ²΄ν¬ν¬μΈνΈ**λ” λ©”λ¨λ¦¬μ λ‚΄λ¶€ μΊμ‹μ—λ§ μ΅΄μ¬ν•λ 'λ”ν‹°(dirty)' λ°μ΄ν„°λ“¤μ„, λ””μ¤ν¬μ— μλ” μκµ¬μ μΈ **λ°μ΄ν„° νμΌ**λ΅ μ®κ²¨ μ λ” μ£ΌκΈ°μ μΈ λ™κΈ°ν™” μ‘μ—…μ…λ‹λ‹¤.

* **λ™μ‘ μ›λ¦¬:**
    1.  κΈ°λ³Έμ μΌλ΅ 60μ΄λ§λ‹¤, λλ” μ €λ„ νμΌμ ν¬κΈ°κ°€ μΌμ • μμ¤€(λ³΄ν†µ 2GB)μ— λ„λ‹¬ν•λ©΄ WiredTigerλ” μ²΄ν¬ν¬μΈνΈλ¥Ό μ‹μ‘ν•©λ‹λ‹¤.
    2.  λ‚΄λ¶€ μΊμ‹μ— μλ” λ¨λ“  'λ”ν‹°' νμ΄μ§€(λ§μ§€λ§‰ μ²΄ν¬ν¬μΈνΈ μ΄ν›„ λ³€κ²½λ λ°μ΄ν„°)λ¥Ό μ‹λ³„ν•©λ‹λ‹¤.
    3.  μ΄ λ”ν‹° νμ΄μ§€λ“¤μ„ λ””μ¤ν¬μ μ‹¤μ  λ°μ΄ν„° νμΌμ— μΌκ΄€λ μƒνƒλ΅ κΈ°λ΅ν•©λ‹λ‹¤.
    4.  λ¨λ“  κΈ°λ΅μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λλ©΄, "μ΄ μ‹μ κΉμ§€μ λ¨λ“  λ°μ΄ν„°λ” μκµ¬ λ°μ΄ν„° νμΌμ— μ•μ „ν•κ² μ €μ¥λμ—μ"μ„ λ‚νƒ€λ‚΄λ” λ©”νƒ€λ°μ΄ν„°λ¥Ό κΈ°λ΅ν•©λ‹λ‹¤.

**μ €λ„λ§κ³Όμ κ΄€κ³„:**
μ²΄ν¬ν¬μΈνΈλ” μ €λ„λ§κ³Ό μƒνΈ λ³΄μ™„μ μΈ κ΄€κ³„μ— μμµλ‹λ‹¤.
* μ²΄ν¬ν¬μΈνΈκ°€ μ„±κ³µμ μΌλ΅ μ™„λ£λλ©΄, ν•΄λ‹Ή μ²΄ν¬ν¬μΈνΈ μ‹μ  μ΄μ „μ— κΈ°λ΅λ μ €λ„ νμΌλ“¤μ€ λ” μ΄μƒ μ¬ν•΄ λ³µκµ¬λ¥Ό μ„ν•΄ ν•„μ”ν•μ§€ μ•κ² λ©λ‹λ‹¤.
* WiredTigerλ” μ΄ μ¤λλ μ €λ„ νμΌλ“¤μ„ μ•μ „ν•κ² μ‚­μ ν•μ—¬ λ””μ¤ν¬ κ³µκ°„μ„ μ¬ν™μ©ν•  μ μμµλ‹λ‹¤.
* μ¦‰, **μ €λ„λ§**μ€ μ²΄ν¬ν¬μΈνΈμ™€ μ²΄ν¬ν¬μΈνΈ μ‚¬μ΄μ μ§§μ€ μ‹κ°„ λ™μ• λ°μƒν•λ” λ³€κ²½ μ‚¬ν•­μ— λ€ν• **λ‹¨κΈ°μ μΈ λ‚΄κµ¬μ„±**μ„ λ³΄μ¥ν•κ³ , **μ²΄ν¬ν¬μΈνΈ**λ” μ΄λ¬ν• λ³€κ²½ μ‚¬ν•­λ“¤μ„ μ£ΌκΈ°μ μΌλ΅ ν†µν•©ν•μ—¬ **μ¥κΈ°μ μΈ μμ†μ„±**μ„ μ κ³µν•κ³  μ €λ„μ„ μ •λ¦¬ν•λ” μ—­ν• μ„ ν•©λ‹λ‹¤.



### μ„±λ¥μ— λ―ΈμΉλ” μν–¥

* **μ €λ„λ§:** λ¨λ“  μ“°κΈ° μ‘μ—…μ— ν¬ν•¨λλ―€λ΅ μ•½κ°„μ μ§€μ—° μ‹κ°„μ„ μ¶”κ°€ν•©λ‹λ‹¤. μ΄ λ•λ¬Έμ— κ³ μ„±λ¥μ΄ μ”κµ¬λλ” μ‹μ¤ν…μ—μ„λ” μ €λ„ νμΌμ΄ μ €μ¥λλ” λ””μ¤ν¬λ¥Ό λ°μ΄ν„° νμΌμ΄ μ €μ¥λλ” λ””μ¤ν¬μ™€ λ¬Όλ¦¬μ μΌλ΅ λ¶„λ¦¬ν•μ—¬ I/O κ²½ν•©μ„ ν”Όν•λ” κµ¬μ„±μ„ κ³ λ ¤ν•κΈ°λ„ ν•©λ‹λ‹¤.
* **μ²΄ν¬ν¬μΈν…:** μ£ΌκΈ°μ μΌλ΅ λ°μƒν•λ” I/O μ§‘μ•½μ μΈ μ‘μ—…μ…λ‹λ‹¤. μ²΄ν¬ν¬μΈνΈκ°€ μ‹¤ν–‰λλ” λ™μ• λ””μ¤ν¬ μ‚¬μ©λ‰μ΄ κΈ‰μ¦ν•μ—¬ λ‹¤λ¥Έ μΏΌλ¦¬μ μ„±λ¥μ— μΌμ‹μ μΈ μν–¥μ„ μ¤„ μ μμµλ‹λ‹¤. WiredTigerλ” μ΄ λ¶€ν•λ¥Ό λ¶„μ‚°μ‹ν‚¤κΈ° μ„ν• μ—¬λ¬ κΈ°λ²•μ„ μ‚¬μ©ν•μ§€λ§, μ“°κΈ° μ‘μ—…μ΄ λ§¤μ° λ§μ€ μ‹μ¤ν…μ—μ„λ” μ²΄ν¬ν¬μΈνΈ ν™λ™μ΄ μ£Όμ” λ¨λ‹ν„°λ§ λ€μƒμ΄ λ©λ‹λ‹¤.

μ €λ„λ§κ³Ό μ²΄ν¬ν¬μΈνΈλ” WiredTigerκ°€ μ κ³µν•λ” λ°μ΄ν„° λ‚΄κµ¬μ„±μ μ–‘λ€ μ¶•μ…λ‹λ‹¤. μ΄ λ‘ λ©”μ»¤λ‹μ¦μ κ²¬κ³ ν• ν‘λ ¥ λ•λ¶„μ—, μ°λ¦¬λ” MongoDBμ— λ°μ΄ν„°λ¥Ό λ―Ώκ³  λ§΅κΈΈ μ μμµλ‹λ‹¤. μ΄λ΅μ¨ MongoDBμ κ°€μ¥ κΉμ€ κ³³, μ¤ν† λ¦¬μ§€ μ—”μ§„μ— λ€ν• νƒκµ¬λ¥Ό λ§λ¬΄λ¦¬ν•©λ‹λ‹¤.