# 05장: 상속 관계 매핑: 객체 지향의 유산을 테이블로

객체지향 프로그래밍의 핵심을 꼽으라면 단연 \*\*상속(Inheritance)\*\*을 들 수 있다. 상속은 부모 클래스의 속성과 기능을 자식 클래스가 물려받아 재사용하고, 더 나아가 확장할 수 있게 해주는 강력한 메커니즘이다. 우리는 상속을 통해 `Item`이라는 추상적인 개념을 만들고, 이를 구체화한 `Album`, `Book`, `Movie`와 같은 자식 클래스들을 만들어낼 수 있다.

하지만 여기서 또다시 패러다임의 벽에 부딪힌다. 우리가 사랑하는 **관계형 데이터베이스에는 '상속'이라는 개념이 존재하지 않기 때문**이다. 그렇다면 이 객체 세상의 아름다운 상속 구조를 어떻게 평면적인 테이블의 세계로 옮겨올 수 있을까?

이번 장에서는 이 근본적인 불일치를 해결하기 위해 JPA가 제공하는 세 가지 핵심 상속 매핑 전략—**조인 전략(JOINED)**, **단일 테이블 전략(SINGLE\_TABLE)**, **클래스별 테이블 전략(TABLE\_PER\_CLASS)**—을 깊이 있게 탐구한다. 각 전략이 데이터베이스 스키마를 어떻게 구성하는지, 어떤 장단점을 가지며 어떤 상황에 가장 적합한지 명확하게 비교 분석할 것이다. 또한, 상속 관계는 아니지만 공통된 속성을 우아하게 재사용할 수 있는 `@MappedSuperclass`의 가치에 대해서도 알아본다. 이 장을 통해 여러분은 객체지향의 유산을 데이터베이스 안에 가장 효율적으로 보존하는 방법을 터득하게 될 것이다.

-----

## 00\. 상속 매핑 전략의 필요성 (객체 vs. 관계형)

먼저, 우리가 데이터베이스에 저장하고자 하는 객체 모델을 살펴보자. 쇼핑몰에서 판매하는 다양한 상품을 표현하기 위해, 공통 속성(`id`, `name`, `price`)을 가진 추상 클래스 `Item`을 정의하고, 이를 `Album`, `Book`, `Movie`가 상속받는 구조다.

**객체 상속 모델**

```kotlin
@Entity
abstract class Item(
    @Id @GeneratedValue
    val id: Long = 0,
    var name: String,
    var price: Int
)

@Entity
class Album(
    var artist: String,
    var etc: String,
    // ... Item의 속성 상속
) : Item()

@Entity
class Book(
    var author: String,
    var isbn: String,
    // ... Item의 속성 상-속
) : Item()
```

이처럼 객체지향적으로는 명확하고 아름다운 구조를, 상속 개념이 없는 관계형 데이터베이스 테이블로는 어떻게 표현해야 할까? 크게 세 가지 방법을 떠올릴 수 있다.

1.  **조인(Joined) 방식**: `ITEM`, `ALBUM`, `BOOK` 테이블을 각각 만들되, `ITEM`에는 공통 속성을, 자식 테이블에는 개별 속성을 저장한다. 그리고 자식 테이블이 부모 테이블의 ID를 기본 키(PK)이자 외래 키(FK)로 사용하여 관계를 맺는다. 가장 정규화된 방식이다.
2.  **단일 테이블(Single Table) 방식**: 상속 계층의 모든 클래스를 단 하나의 `ITEM` 테이블로 표현한다. `artist`, `author`, `isbn` 등 모든 자식 클래스의 속성을 이 테이블에 전부 포함시키고, `DTYPE`(Discriminator Type)이라는 구분 컬럼을 두어 어떤 종류의 아이템인지 식별한다.
3.  **클래스별 테이블(Table per Class) 방식**: `ALBUM`, `BOOK` 테이블만 만든다. 공통 속성인 `name`, `price`를 포함한 모든 필드를 각자의 테이블에 중복해서 갖는 방식이다.

이 세 가지 데이터베이스 설계 방식이 바로 JPA가 제공하는 **조인 전략, 단일 테이블 전략, 클래스별 테이블 전략**과 정확히 일치한다. JPA는 `@Inheritance(strategy = ...)` 어노테이션을 통해 개발자가 이 전략들 중 하나를 선택할 수 있게 해준다.

어떤 전략이 항상 옳다고 말할 수는 없다. 각 전략은 데이터베이스 스키마, 조회 성능, 저장 공간 효율성, 쿼리의 복잡성 등 여러 측면에서 뚜렷한 장단점을 가진다. 따라서 우리는 각 전략의 특징을 명확히 이해하고, 우리 시스템의 요구사항에 가장 적합한 전략을 선택할 수 있는 안목을 길러야 한다.

이제 첫 번째 전략인 조인 전략부터 자세히 살펴보자.